// ==== Icon stubs (lucide-react) ====

function ArrowLeft(props) {
  return (
    <svg width="16" height="16" viewBox="0 0 16 16" {...props}>
      <rect x="2" y="2" width="12" height="12" fill="none" stroke="currentColor" strokeWidth="1.5" />
    </svg>
  );
}
window.ArrowLeft = ArrowLeft;

function BookmarkCheck(props) {
  return (
    <svg width="16" height="16" viewBox="0 0 16 16" {...props}>
      <rect x="2" y="2" width="12" height="12" fill="none" stroke="currentColor" strokeWidth="1.5" />
    </svg>
  );
}
window.BookmarkCheck = BookmarkCheck;

function Camera(props) {
  return (
    <svg width="16" height="16" viewBox="0 0 16 16" {...props}>
      <rect x="2" y="2" width="12" height="12" fill="none" stroke="currentColor" strokeWidth="1.5" />
    </svg>
  );
}
window.Camera = Camera;

function CheckCircle2(props) {
  return (
    <svg width="16" height="16" viewBox="0 0 16 16" {...props}>
      <rect x="2" y="2" width="12" height="12" fill="none" stroke="currentColor" strokeWidth="1.5" />
    </svg>
  );
}
window.CheckCircle2 = CheckCircle2;

function ChevronRight(props) {
  return (
    <svg width="16" height="16" viewBox="0 0 16 16" {...props}>
      <rect x="2" y="2" width="12" height="12" fill="none" stroke="currentColor" strokeWidth="1.5" />
    </svg>
  );
}
window.ChevronRight = ChevronRight;

function Heart(props) {
  return (
    <svg width="16" height="16" viewBox="0 0 16 16" {...props}>
      <rect x="2" y="2" width="12" height="12" fill="none" stroke="currentColor" strokeWidth="1.5" />
    </svg>
  );
}
window.Heart = Heart;

function HelpCircle(props) {
  return (
    <svg width="16" height="16" viewBox="0 0 16 16" {...props}>
      <rect x="2" y="2" width="12" height="12" fill="none" stroke="currentColor" strokeWidth="1.5" />
    </svg>
  );
}
window.HelpCircle = HelpCircle;

function Map(props) {
  return (
    <svg width="16" height="16" viewBox="0 0 16 16" {...props}>
      <rect x="2" y="2" width="12" height="12" fill="none" stroke="currentColor" strokeWidth="1.5" />
    </svg>
  );
}
window.Map = Map;

function MapPin(props) {
  return (
    <svg width="16" height="16" viewBox="0 0 16 16" {...props}>
      <rect x="2" y="2" width="12" height="12" fill="none" stroke="currentColor" strokeWidth="1.5" />
    </svg>
  );
}
window.MapPin = MapPin;

function Navigation2(props) {
  return (
    <svg width="16" height="16" viewBox="0 0 16 16" {...props}>
      <rect x="2" y="2" width="12" height="12" fill="none" stroke="currentColor" strokeWidth="1.5" />
    </svg>
  );
}
window.Navigation2 = Navigation2;

function Pause(props) {
  return (
    <svg width="16" height="16" viewBox="0 0 16 16" {...props}>
      <rect x="2" y="2" width="12" height="12" fill="none" stroke="currentColor" strokeWidth="1.5" />
    </svg>
  );
}
window.Pause = Pause;

function Pencil(props) {
  return (
    <svg width="16" height="16" viewBox="0 0 16 16" {...props}>
      <rect x="2" y="2" width="12" height="12" fill="none" stroke="currentColor" strokeWidth="1.5" />
    </svg>
  );
}
window.Pencil = Pencil;

function Play(props) {
  return (
    <svg width="16" height="16" viewBox="0 0 16 16" {...props}>
      <rect x="2" y="2" width="12" height="12" fill="none" stroke="currentColor" strokeWidth="1.5" />
    </svg>
  );
}
window.Play = Play;

function Plus(props) {
  return (
    <svg width="16" height="16" viewBox="0 0 16 16" {...props}>
      <rect x="2" y="2" width="12" height="12" fill="none" stroke="currentColor" strokeWidth="1.5" />
    </svg>
  );
}
window.Plus = Plus;

function SkipForward(props) {
  return (
    <svg width="16" height="16" viewBox="0 0 16 16" {...props}>
      <rect x="2" y="2" width="12" height="12" fill="none" stroke="currentColor" strokeWidth="1.5" />
    </svg>
  );
}
window.SkipForward = SkipForward;

function SquareCheckBig(props) {
  return (
    <svg width="16" height="16" viewBox="0 0 16 16" {...props}>
      <rect x="2" y="2" width="12" height="12" fill="none" stroke="currentColor" strokeWidth="1.5" />
    </svg>
  );
}
window.SquareCheckBig = SquareCheckBig;

function Trash2(props) {
  return (
    <svg width="16" height="16" viewBox="0 0 16 16" {...props}>
      <rect x="2" y="2" width="12" height="12" fill="none" stroke="currentColor" strokeWidth="1.5" />
    </svg>
  );
}
window.Trash2 = Trash2;

function X(props) {
  return (
    <svg width="16" height="16" viewBox="0 0 16 16" {...props}>
      <rect x="2" y="2" width="12" height="12" fill="none" stroke="currentColor" strokeWidth="1.5" />
    </svg>
  );
}
window.X = X;

function XIcon(props) {
  return (
    <svg width="16" height="16" viewBox="0 0 16 16" {...props}>
      <rect x="2" y="2" width="12" height="12" fill="none" stroke="currentColor" strokeWidth="1.5" />
    </svg>
  );
}
window.XIcon = XIcon;


// ==== bucketlisted_list_template_mockup_final.jsx ====

// ==============================
// Mock data
// ==============================
const ITEMS = [
  { id: 1, title: "Space Center Houston", excerpt: "Tour mission control, touch moon rocks, and catch a live astronaut talk." },
  { id: 2, title: "Houston Museum District", excerpt: "Walkable cluster of world-class museums across leafy boulevards." },
  { id: 3, title: "Houston Astros (Minute Maid Park)", excerpt: "Roof open? Even better. Grab a beer and cheer from the Crawford Boxes." },
  { id: 4, title: "Houston Livestock Show & Rodeo", excerpt: "Barbecue smoke, bucking broncs, and big-name concerts—Texas-sized." },
  { id: 5, title: "Houston Museum of Natural Science", excerpt: "Dinosaurs, planetarium, and a stunning hall of gems & minerals." },
  { id: 6, title: "Houston Zoo", excerpt: "Giraffes, gorillas, and shady paths in Hermann Park—great with kids." },
  { id: 7, title: "Buffalo Bayou Park", excerpt: "Skyline views, trails, and the famous bat colony at the Waugh Bridge." },
  { id: 8, title: "The Menil Collection", excerpt: "A serene, free art oasis—Rothko Chapel is steps away." },
  { id: 9, title: "Discovery Green", excerpt: "Downtown lawn with art, splash pads, and seasonal ice skating." },
  { id: 10, title: "Kemah Boardwalk", excerpt: "Rides, waterfront dining, and sunset over the bay." },
  { id: 11, title: "Galveston Day Trip", excerpt: "Historic Strand district, Pleasure Pier, and miles of beach." },
  { id: 12, title: "Art Car Museum", excerpt: "Quirky, shiny, and unmistakably Houston—tiny but memorable." },
];

// ==============================
// Helpers (URL + localStorage)
// ==============================
const parseChecksParam = (param: string): number[] => {
  return (param || "")
    .split(",")
    .map((x) => parseInt(x.trim(), 10))
    .filter((n) => Number.isFinite(n));
};

const loadChecks = (): number[] => {
  try {
    const params = new URLSearchParams(window.location.search);
    const urlChecks = params.get("checks");
    if (urlChecks) return parseChecksParam(urlChecks);
    const raw = localStorage.getItem("bucketlisted:houston:checks");
    return raw ? JSON.parse(raw) : [];
  } catch {
    return [];
  }
};

const saveChecks = (ids: number[]) => {
  try { localStorage.setItem("bucketlisted:houston:checks", JSON.stringify(ids)); } catch {}
};

const makeProgressURL = (ids: number[]) => {
  const base = window.location.origin + window.location.pathname;
  if (!ids?.length) return base; // no checks → plain list URL
  const qs = new URLSearchParams({ checks: ids.join(",") }).toString();
  return `${base}?${qs}`;
};

// ==============================
// UI style system for controls (unifies Show/View/Share)
// ==============================
const ui = {
  group: "isolate inline-flex rounded-full shadow-sm",
  btnBase:
    "px-4 h-10 text-sm md:text-base font-semibold border transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#3B82F6]",
  btnBrand: "bg-white border-[#3B82F6] text-[#3B82F6] hover:bg-[#3B82F6] hover:text-white",
  btnActive: "bg-[#3B82F6] text-white border-[#3B82F6]",
  left: "rounded-l-full",
  right: "rounded-r-full",
  solo: "rounded-full",
};

// tiny helper to compose classes
const cx = (...parts: Array<string | false | undefined>) => parts.filter(Boolean).join(" ");

// ==============================
// Dev sanity tests (keep lightweight)
// ==============================
if (typeof window !== "undefined") {
  const base = window.location.origin + window.location.pathname;
  console.assert(makeProgressURL([]) === base, "makeProgressURL([]) should return base URL");
  console.assert(makeProgressURL([1, 2]).includes("checks=1,2"), "makeProgressURL should include checks list in order");
  console.assert(!makeProgressURL([1, 2]).endsWith(","), "makeProgressURL should not end with a trailing comma");
  console.assert(JSON.stringify(parseChecksParam("1, 2, x, 5")) === JSON.stringify([1,2,5]), "parseChecksParam should ignore non-numbers and trim");
  console.assert(JSON.stringify(parseChecksParam("")) === JSON.stringify([]), "parseChecksParam should handle empty string");
  // UI contract: active has brand bg
  console.assert(ui.btnActive.includes("bg-[#3B82F6]") && ui.btnBrand.includes("text-[#3B82F6]"), "UI control classes should include brand colors");
  // New: cx helper composes and skips falsy
  console.assert(cx("a", false, "b") === "a b", "cx() should join truthy parts with spaces");
}

// ==============================
// UI bits
// ==============================
function ProgressRing({ pct = 0, size = 22, stroke = 3 }: { pct?: number; size?: number; stroke?: number }) {
  const r = (size - stroke) / 2;
  const c = 2 * Math.PI * r;
  const dash = Math.max(0, Math.min(1, pct / 100)) * c;
  return (
    <svg width={size} height={size} viewBox={`0 0 ${size} ${size}`} className="shrink-0">
      <circle cx={size / 2} cy={size / 2} r={r} stroke="#E5E7EB" strokeWidth={stroke} fill="none" />
      <circle
        cx={size / 2}
        cy={size / 2}
        r={r}
        stroke="#EC555C" // brand coral
        strokeWidth={stroke}
        fill="none"
        strokeLinecap="round"
        strokeDasharray={`${dash} ${c - dash}`}
        transform={`rotate(-90 ${size / 2} ${size / 2})`}
      />
    </svg>
  );
}

const PosterCard = () => (
  <div className="relative aspect-[3/4] w-full overflow-hidden rounded-xl border bg-white shadow">
    <div className="absolute inset-0 bg-gradient-to-b from-gray-50 to-gray-100" />
    <div className="relative p-3">
      <div className="mb-2 h-5 w-28 rounded bg-gray-200" />
      <div className="h-40 rounded bg-gray-200" />
    </div>
    <div className="absolute bottom-0 left-0 right-0 p-3 text-xs text-gray-600">Add a name or dedication (e.g., "Jackson Family Trip • 2025")</div>
  </div>
);

// ==============================
// Main component
// ==============================
function HoustonListTemplateMock() {
  const [checked, setChecked] = useState<number[]>([]);
  const [expanded, setExpanded] = useState<number[]>([]);
  const [view, setView] = useState<"compact" | "expanded">("compact");
  const [shareMenu, setShareMenu] = useState(false);
  const [showFilter, setShowFilter] = useState<"all" | "todo" | "done">("all");
  const [showMenu, setShowMenu] = useState(false);
  const [showPopover, setShowPopover] = useState(false);
  const [showPreview, setShowPreview] = useState(false);

  // init
  useEffect(() => setChecked(loadChecks()), []);
  useEffect(() => saveChecks(checked), [checked]);
  useEffect(() => {
    if (view === "expanded") setExpanded(ITEMS.map((i) => i.id));
    else setExpanded([]);
  }, [view]);

  // demo email pop
  useEffect(() => {
    const dismissed = localStorage.getItem("bucketlisted:houston:freeposter_dismissed");
    const t = setTimeout(() => { if (!dismissed) setShowPopover(true); }, 4000);
    return () => clearTimeout(t);
  }, []);

  const dismissPopover = () => {
    setShowPopover(false);
    try { localStorage.setItem("bucketlisted:houston:freeposter_dismissed", "1"); } catch {}
  };

  const toggleCheck = (id: number) => setChecked((prev) => (prev.includes(id) ? prev.filter((x) => x !== id) : [...prev, id]));
  const toggleExpand = (id: number) => setExpanded((prev) => (prev.includes(id) ? prev.filter((x) => x !== id) : [...prev, id]));

  const count = checked.length;
  const max = ITEMS.length;
  const pct = Math.round((count / max) * 100) || 0;

  const shareList = async () => {
    const url = makeProgressURL([]);
    if (navigator.share) { try { await navigator.share({ title: "Houston Bucket List", text: "Houston Bucket List", url }); } catch {}
    } else if (navigator.clipboard) { await navigator.clipboard.writeText(url); alert("List URL copied to clipboard"); }
  };
  const shareMyProgress = async () => {
    const url = makeProgressURL(checked);
    const text = `I've checked ${count}/${max} on the Houston Bucket List!`;
    if (navigator.share) { try { await navigator.share({ title: "My Houston progress", text, url }); } catch {}
    } else if (navigator.clipboard) { await navigator.clipboard.writeText(url); alert("Your progress link is copied to clipboard"); }
  };

  const filtered = ITEMS.filter((it) => {
    if (showFilter === "todo") return !checked.includes(it.id);
    if (showFilter === "done") return checked.includes(it.id);
    return true;
  });

  return (
    <div className="min-h-screen bg-slate-50 text-slate-900">
      {/* ================================= Hero ================================= */}
      <header className="relative isolate grid min-h-[55vh] md:min-h-[65vh] place-items-center overflow-hidden">
        <div className="absolute inset-0 -z-10">
          {/* Replace with real travel photo via CSS background-image on production */}
          <div className="absolute inset-0 bg-gradient-to-tr from-[#EC555C]/25 via-[#3B82F6]/20 to-transparent" />
          <div className="absolute inset-0 bg-black/40" />
        </div>
        <div className="mx-auto w-full max-w-7xl px-4 text-center">
          <div className="space-y-2">
            <h1 className="text-5xl md:text-7xl font-extrabold tracking-tight text-white drop-shadow-sm">Houston Bucket List</h1>
            <div className="mx-auto inline-flex items-center gap-2 rounded-full bg-[#EC555C] px-5 py-1.5 text-base font-extrabold text-white shadow md:text-lg">
              60 Best Things To Do in Houston
            </div>
            {/* Elevator line only (no intro card) */}
            <div className="text-white/95 text-base md:text-lg">A curated mix of icons + local gems, optimized for a weekend.</div>
          </div>
        </div>
      </header>

      {/* ================================= Main ================================= */}
      <main className="mx-auto grid max-w-7xl grid-cols-1 gap-6 px-4 py-6 md:grid-cols-12">
        {/* Left column */}
        <section className="md:col-span-8 lg:col-span-8">
          {/* Toolbar: Show (left) + View (right) — unified styles */}
          <div className="mb-4 flex flex-wrap items-center justify-between gap-3">
            <div className="relative shrink-0">
              <div className={ui.group}>
                <button onClick={() => setShowMenu((s) => !s)} className={cx(ui.btnBase, ui.btnBrand, ui.left) + " whitespace-nowrap"}>
                  Show: {showFilter === "all" ? "All" : showFilter === "todo" ? "To do" : "Done"}
                </button>
                <button onClick={() => setShowMenu((s) => !s)} className={cx(ui.btnBase, ui.btnBrand, ui.right)} aria-label="More show options">▼</button>
              </div>
              {showMenu && (
                <div className="absolute left-0 z-10 mt-2 w-40 overflow-hidden rounded-xl border bg-white shadow">
                  <button onClick={() => { setShowFilter("all"); setShowMenu(false); }} className="block w-full px-3 py-2 text-left text-sm hover:bg-slate-50">All</button>
                  <button onClick={() => { setShowFilter("todo"); setShowMenu(false); }} className="block w-full px-3 py-2 text-left text-sm hover:bg-slate-50">To do</button>
                  <button onClick={() => { setShowFilter("done"); setShowMenu(false); }} className="block w-full px-3 py-2 text-left text-sm hover:bg-slate-50">Done</button>
                </div>
              )}
            </div>

            <div className="flex items-center gap-2 text-sm">
              <div className={ui.group}>
                <button className={cx(ui.btnBase, view === "compact" ? ui.btnActive : ui.btnBrand, ui.left)} onClick={() => setView("compact")}>Compact</button>
                <button className={cx(ui.btnBase, view === "expanded" ? ui.btnActive : ui.btnBrand, ui.right)} onClick={() => setView("expanded")}>Expanded</button>
              </div>
            </div>
          </div>

          {/* List */}
          <ol className="space-y-3 md:space-y-4">
            {filtered.map((item) => {
              const isChecked = checked.includes(item.id);
              const isOpen = expanded.includes(item.id);
              const number = ITEMS.findIndex((i) => i.id === item.id) + 1;

              return (
                <li key={item.id} className="rounded-2xl border border-slate-200 bg-white p-3 md:p-4 shadow-sm">
                  <div className="flex items-start gap-3">
                    {/* Checkbox coral (smaller visual, large hit area) */}
                    {(() => { const cid = `check-${item.id}`; return (
                      <label htmlFor={cid} className="flex h-11 w-11 shrink-0 items-center justify-center rounded-full hover:bg-slate-50 cursor-pointer">
                        <input
                          id={cid}
                          type="checkbox"
                          className="h-6 w-6 rounded border-slate-300 text-[#EC555C] accent-[#EC555C] focus:ring-[#EC555C]"
                          checked={isChecked}
                          onChange={() => toggleCheck(item.id)}
                          aria-label={`Mark ${item.title} done`}
                        />
                      </label>
                    ); })()}

                    {/* Rank badge — blue with white text */}
                    <div className="flex h-11 w-11 shrink-0 items-center justify-center rounded-full bg-[#3B82F6] text-white shadow-sm ring-1 ring-black/5 font-extrabold text-base md:text-lg">
                      {number}
                    </div>

                    <div className="min-w-0 flex-1">
                      <div className="grid grid-cols-[1fr_auto] grid-rows-[auto_auto] items-center gap-x-3 gap-y-1">
                        <button className="col-start-1 row-start-1 flex w-full items-center justify-between gap-2 text-left" onClick={() => toggleExpand(item.id)}>
                          <h3 className={`truncate text-lg md:text-xl font-bold ${isChecked ? "line-through decoration-2" : ""}`}>{item.title}</h3>
                          <svg className={`h-5 w-5 transition-transform ${isOpen ? "rotate-180" : ""}`} viewBox="0 0 20 20" fill="currentColor"><path d="M5.23 7.21a.75.75 0 011.06.02L10 11.06l3.71-3.83a.75.75 0 111.08 1.04l-4.25 4.4a.75.75 0 01-1.08 0l-4.25-4.4a.75.75 0 01.02-1.06z"/></svg>
                        </button>
                        {/* Right-aligned square thumb when collapsed */}
                        <div className={`hidden sm:block self-center row-span-2 ${isOpen ? "opacity-0" : "opacity-100"}`}>
                          <div className="h-16 w-16 rounded-lg bg-slate-100" />
                        </div>
                        {/* Tight excerpt */}
                        <p className="col-start-1 row-start-2 mt-0 text-sm md:text-base leading-snug text-slate-600 line-clamp-2">{item.excerpt}</p>
                      </div>
                      {/* Expanded content */}
                      {isOpen && (
                        <div className="mt-3 grid gap-3 md:grid-cols-3">
                          <div className="md:col-span-2">
                            <div className="h-48 w-full rounded-xl bg-slate-100" />
                            <div className="mt-3 space-y-2 text-sm text-slate-700">
                              <p>Why it's on the list: succinct, persuasive blurb explaining the appeal and best-time-to-go tips.</p>
                              <div className="flex flex-wrap gap-2">
                                <a href="#" className="rounded-lg border px-3 py-2 hover:bg-slate-50 text-[#3B82F6]">Read more</a>
                                <a href="#" className="rounded-lg border px-3 py-2 hover:bg-slate-50 text-[#3B82F6]">Get directions</a>
                              </div>
                            </div>
                          </div>
                        </div>
                      )}
                    </div>
                  </div>
                </li>
              );
            })}
          </ol>
        </section>

        {/* Right rail */}
        <aside className="md:col-span-4 lg:col-span-4">
          <div className="sticky top-4 space-y-4">
            {/* Progress Pill — now the first right-rail card */}
            <div className="rounded-2xl border border-slate-200 bg-white p-4 shadow-sm">
              <div className="flex items-center justify-between gap-3">
                <div className="inline-flex items-center gap-2">
                  <ProgressRing pct={pct} size={24} />
                  <div className="text-base md:text-lg font-semibold text-slate-900">{count}/{max}</div>
                </div>
                <div className="relative shrink-0">
                  <div className={ui.group}>
                    <button onClick={() => (count ? shareMyProgress() : shareList())} className={cx(ui.btnBase, ui.btnBrand, ui.left) + " whitespace-nowrap"}>
                      Share {count ? "my progress" : "list"}
                    </button>
                    <button onClick={() => setShareMenu((s) => !s)} className={cx(ui.btnBase, ui.btnBrand, ui.right)} aria-label="More share options">▼</button>
                  </div>
                  {shareMenu && (
                    <div className="absolute right-0 z-10 mt-2 w-52 overflow-hidden rounded-xl border bg-white shadow">
                      <button onClick={shareList} className="block w-full px-3 py-2 text-left text-sm hover:bg-slate-50">Share list (blank)</button>
                      <button onClick={shareMyProgress} className="block w-full px-3 py-2 text-left text-sm hover:bg-slate-50">Share my progress</button>
                      <button onClick={() => setShowPreview(true)} className="block w-full px-3 py-2 text-left text-sm hover:bg-slate-50">Preview social image</button>
                    </div>
                  )}
                </div>
              </div>
            </div>

            {/* Map (lazy in prod) */}
            <div id="map" className="rounded-2xl border border-slate-200 bg-white p-4 shadow-sm">
              <div className="mb-2 font-semibold">Map</div>
              <div className="h-56 w-full rounded-xl bg-slate-100" />
              <p className="mt-2 text-xs text-slate-600">Map loads only when viewed in production for max performance.</p>
            </div>

            {/* Explore more in Houston */}
            <div className="rounded-2xl border border-slate-200 bg-white p-4 shadow-sm">
              <div className="mb-2 font-semibold">Explore more in Houston</div>
              <ul className="space-y-2 text-sm">
                <li><a className="text-[#3B82F6] hover:underline" href="#">12 Free Things To Do in Houston</a></li>
                <li><a className="text-[#3B82F6] hover:underline" href="#">Romantic Things To Do in Houston</a></li>
                <li><a className="text-[#3B82F6] hover:underline" href="#">Houston with Kids</a></li>
              </ul>
            </div>

            {/* Store promos */}
            <div id="store" className="space-y-4">
              <div className="rounded-2xl border border-rose-200 bg-white p-4 shadow-sm">
                <div className="mb-2 font-semibold">Personalized Poster</div>
                <div className="mb-3"><PosterCard /></div>
                <ul className="mb-3 list-inside list-disc text-sm text-slate-700">
                  <li>Add your name or dedication</li>
                  <li>Optional frame</li>
                  <li>Ships fast</li>
                </ul>
                <button className="w-full rounded-lg bg-[#EC555C] py-2 text-sm font-semibold text-white hover:opacity-90">Preview my poster</button>
              </div>

              <div className="rounded-2xl border border-purple-200 bg-white p-4 shadow-sm">
                <div className="mb-2 font-semibold">The Gift Bundle <span className="ml-2 rounded bg-purple-50 px-2 py-0.5 text-xs text-purple-700">Most popular</span></div>
                <ul className="mb-3 list-inside list-disc text-sm text-slate-700">
                  <li>Poster + Pocket Book</li>
                  <li>Gift note card included</li>
                  <li>Personalize recipient name</li>
                  <li>Ready-to-gift sleeve</li>
                </ul>
                <div className="mb-2 text-xs text-slate-600">Great for birthdays • housewarmings • graduations</div>
                <button className="w-full rounded-lg bg-purple-600 py-2 text-sm font-semibold text-white hover:bg-purple-700">Get the bundle</button>
              </div>

              <div className="rounded-2xl border border-amber-200 bg-white p-4 shadow-sm">
                <div className="mb-2 font-semibold">Limited‑Edition Houston Print</div>
                <div className="text-sm text-slate-700">Numbered run, archival inks, optional frame. 30‑day returns.</div>
                <button className="mt-3 w-full rounded-lg bg-amber-600 py-2 text-sm font-semibold text-white hover:bg-amber-700">See sizes & frames</button>
              </div>
            </div>
          </div>
        </aside>
      </main>

      {/* ========================== Email capture popover ========================== */}
      {showPopover && (
        <div className="fixed inset-0 z-[60] flex items-center justify-center bg-black/50 p-4">
          <div className="w-full max-w-md rounded-2xl bg-white p-5 shadow-2xl">
            <div className="mb-2 text-lg font-extrabold">FREE Poster + Travel Guide</div>
            <p className="text-sm text-slate-600">Get a printable Houston poster and a quick-start weekend guide. We'll send it right to your inbox.</p>
            <div className="mt-3 flex gap-2">
              <input className="flex-1 rounded-lg border px-3 py-2" placeholder="you@example.com" />
              <button className="rounded-lg bg-emerald-600 px-4 py-2 text-sm font-semibold text-white">Send</button>
            </div>
            <div className="mt-3 text-center text-xs text-slate-500">
              <button onClick={dismissPopover} className="underline">No thanks</button>
            </div>
          </div>
        </div>
      )}

      {/* =============================== Social preview =============================== */}
      {showPreview && (
        <div className="fixed inset-0 z-[70] flex items-center justify-center bg-black/50 p-4" onClick={() => setShowPreview(false)}>
          <div className="w-full max-w-2xl rounded-2xl bg-white p-5 shadow-2xl" onClick={(e) => e.stopPropagation()}>
            <div className="mb-3 text-lg font-extrabold">Share preview</div>
            <div className="relative overflow-hidden rounded-xl border bg-white">
              <div className="aspect-[1200/630] bg-gradient-to-tr from-[#FDECF0] via-white to-[#EAF2F8] p-6">
                <div className="flex h-full items-center justify-between">
                  <div className="space-y-2">
                    <div className="inline-flex items-center gap-2 rounded-full bg-[#EC555C] px-3 py-1 text-sm font-extrabold text-white">Houston Bucket List</div>
                    <div className="text-3xl font-black text-slate-900">{count}/{max} completed</div>
                  </div>
                  <div className="flex items-center gap-3">
                    <ProgressRing pct={pct} size={80} stroke={8} />
                    <div className="text-4xl font-extrabold text-slate-900">{pct}%</div>
                  </div>
                </div>
              </div>
            </div>
            <div className="mt-3 flex justify-end">
              <button className="rounded-lg border px-3 py-2 text-sm" onClick={() => setShowPreview(false)}>Close</button>
            </div>
          </div>
        </div>
      )}

      {/* ============================== Mobile action dock ============================== */}
      <div className="fixed inset-x-0 bottom-0 z-50 border-t border-slate-200 bg-white/95 backdrop-blur md:hidden">
        <div className="mx-auto max-w-3xl px-3 py-2">
          <div className="flex items-center justify-between gap-2">
            {/* Progress pill becomes the mobile anchor (full) */}
            <div className="inline-flex items-center gap-2">
              <ProgressRing pct={pct} size={24} />
              <span className="text-base font-semibold">{count}/{max}</span>
            </div>
            <div className="relative shrink-0">
              <div className={ui.group}>
                <button onClick={() => (count ? shareMyProgress() : shareList())} className={cx(ui.btnBase, ui.btnBrand, ui.left) + " whitespace-nowrap"}>
                  Share {count ? "my progress" : "list"}
                </button>
                <button onClick={() => setShareMenu((s) => !s)} className={cx(ui.btnBase, ui.btnBrand, ui.right)} aria-label="More share options">▼</button>
              </div>
              {shareMenu && (
                <div className="absolute right-0 z-10 -top-1 -translate-y-full w-52 overflow-hidden rounded-xl border bg-white shadow">
                  <button onClick={shareList} className="block w-full px-3 py-2 text-left text-sm hover:bg-slate-50">Share list (blank)</button>
                  <button onClick={shareMyProgress} className="block w-full px-3 py-2 text-left text-sm hover:bg-slate-50">Share my progress</button>
                  <button onClick={() => setShowPreview(true)} className="block w-full px-3 py-2 text-left text-sm hover:bg-slate-50">Preview social image</button>
                </div>
              )}
            </div>
          </div>
        </div>
      </div>

      <footer className="pb-20 md:pb-8" />
    </div>
  );
}


window.HoustonListTemplateMock = HoustonListTemplateMock;


// ==== bucketlisted_list_template_houston_mockup (2).jsx ====

// ==============================
// Mock data
// ==============================
const ITEMS = [
  { id: 1, title: "Space Center Houston", excerpt: "Tour mission control, touch moon rocks, and catch a live astronaut talk." },
  { id: 2, title: "Houston Museum District", excerpt: "Walkable cluster of world-class museums across leafy boulevards." },
  { id: 3, title: "Houston Astros (Minute Maid Park)", excerpt: "Roof open? Even better. Grab a beer and cheer from the Crawford Boxes." },
  { id: 4, title: "Houston Livestock Show & Rodeo", excerpt: "Barbecue smoke, bucking broncs, and big-name concerts—Texas-sized." },
  { id: 5, title: "Houston Museum of Natural Science", excerpt: "Dinosaurs, planetarium, and a stunning hall of gems & minerals." },
  { id: 6, title: "Houston Zoo", excerpt: "Giraffes, gorillas, and shady paths in Hermann Park—great with kids." },
  { id: 7, title: "Buffalo Bayou Park", excerpt: "Skyline views, trails, and the famous bat colony at the Waugh Bridge." },
  { id: 8, title: "The Menil Collection", excerpt: "A serene, free art oasis—Rothko Chapel is steps away." },
  { id: 9, title: "Discovery Green", excerpt: "Downtown lawn with art, splash pads, and seasonal ice skating." },
  { id: 10, title: "Kemah Boardwalk", excerpt: "Rides, waterfront dining, and sunset over the bay." },
  { id: 11, title: "Galveston Day Trip", excerpt: "Historic Strand district, Pleasure Pier, and miles of beach." },
  { id: 12, title: "Art Car Museum", excerpt: "Quirky, shiny, and unmistakably Houston—tiny but memorable." },
];

// ==============================
// Helpers (URL + localStorage)
// ==============================
const parseChecksParam = (param: string): number[] => {
  return (param || "")
    .split(",")
    .map((x) => parseInt(x.trim(), 10))
    .filter((n) => Number.isFinite(n));
};

const loadChecks = (): number[] => {
  try {
    const params = new URLSearchParams(window.location.search);
    const urlChecks = params.get("checks");
    if (urlChecks) return parseChecksParam(urlChecks);
    const raw = localStorage.getItem("bucketlisted:houston:checks");
    return raw ? JSON.parse(raw) : [];
  } catch {
    return [];
  }
};

const saveChecks = (ids: number[]) => {
  try { localStorage.setItem("bucketlisted:houston:checks", JSON.stringify(ids)); } catch {}
};

const makeProgressURL = (ids: number[]) => {
  const base = window.location.origin + window.location.pathname;
  if (!ids?.length) return base; // no checks → plain list URL
  const qs = new URLSearchParams({ checks: ids.join(",") }).toString();
  return `${base}?${qs}`;
};

// ==============================
// UI style system for controls (unifies Show/View/Share)
// ==============================
const ui = {
  group: "isolate inline-flex rounded-full shadow-sm",
  btnBase:
    "px-3 h-9 text-sm font-semibold border transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#3B82F6]",
  btnBrand: "bg-white border-[#3B82F6] text-[#3B82F6] hover:bg-[#3B82F6] hover:text-white",
  btnActive: "bg-[#3B82F6] text-white border-[#3B82F6]",
  left: "rounded-l-full",
  right: "rounded-r-full",
  solo: "rounded-full",
};

// tiny helper to compose classes
const cx = (...parts: Array<string | false | undefined>) => parts.filter(Boolean).join(" ");

// ==============================
// Dev sanity tests (keep lightweight)
// ==============================
if (typeof window !== "undefined") {
  const base = window.location.origin + window.location.pathname;
  console.assert(makeProgressURL([]) === base, "makeProgressURL([]) should return base URL");
  console.assert(makeProgressURL([1, 2]).includes("checks=1,2"), "makeProgressURL should include checks list in order");
  console.assert(!makeProgressURL([1, 2]).endsWith(","), "makeProgressURL should not end with a trailing comma");
  console.assert(JSON.stringify(parseChecksParam("1, 2, x, 5")) === JSON.stringify([1,2,5]), "parseChecksParam should ignore non-numbers and trim");
  console.assert(JSON.stringify(parseChecksParam("")) === JSON.stringify([]), "parseChecksParam should handle empty string");
  // UI contract: active has brand bg
  console.assert(ui.btnActive.includes("bg-[#3B82F6]") && ui.btnBrand.includes("text-[#3B82F6]"), "UI control classes should include brand colors");
}

// ==============================
// UI bits
// ==============================
function ProgressRing({ pct = 0, size = 22, stroke = 3 }: { pct?: number; size?: number; stroke?: number }) {
  const r = (size - stroke) / 2;
  const c = 2 * Math.PI * r;
  const dash = Math.max(0, Math.min(1, pct / 100)) * c;
  return (
    <svg width={size} height={size} viewBox={`0 0 ${size} ${size}`} className="shrink-0">
      <circle cx={size / 2} cy={size / 2} r={r} stroke="#E5E7EB" strokeWidth={stroke} fill="none" />
      <circle
        cx={size / 2}
        cy={size / 2}
        r={r}
        stroke="#EC555C" // brand coral
        strokeWidth={stroke}
        fill="none"
        strokeLinecap="round"
        strokeDasharray={`${dash} ${c - dash}`}
        transform={`rotate(-90 ${size / 2} ${size / 2})`}
      />
    </svg>
  );
}

const PosterCard = () => (
  <div className="relative aspect-[3/4] w-full overflow-hidden rounded-xl border bg-white shadow">
    <div className="absolute inset-0 bg-gradient-to-b from-gray-50 to-gray-100" />
    <div className="relative p-3">
      <div className="mb-2 h-5 w-28 rounded bg-gray-200" />
      <div className="h-40 rounded bg-gray-200" />
    </div>
    <div className="absolute bottom-0 left-0 right-0 p-3 text-xs text-gray-600">Add a name or dedication (e.g., "Jackson Family Trip • 2025")</div>
  </div>
);

// ==============================
// Main component
// ==============================
function HoustonListTemplateMock() {
  const [checked, setChecked] = useState<number[]>([]);
  const [expanded, setExpanded] = useState<number[]>([]);
  const [view, setView] = useState<"compact" | "expanded">("compact");
  const [shareMenu, setShareMenu] = useState(false);
  const [showFilter, setShowFilter] = useState<"all" | "todo" | "done">("all");
  const [showMenu, setShowMenu] = useState(false);
  const [showPopover, setShowPopover] = useState(false);
  const [showPreview, setShowPreview] = useState(false);

  // init
  useEffect(() => setChecked(loadChecks()), []);
  useEffect(() => saveChecks(checked), [checked]);
  useEffect(() => {
    if (view === "expanded") setExpanded(ITEMS.map((i) => i.id));
    else setExpanded([]);
  }, [view]);

  // demo email pop
  useEffect(() => {
    const dismissed = localStorage.getItem("bucketlisted:houston:freeposter_dismissed");
    const t = setTimeout(() => { if (!dismissed) setShowPopover(true); }, 4000);
    return () => clearTimeout(t);
  }, []);

  const dismissPopover = () => {
    setShowPopover(false);
    try { localStorage.setItem("bucketlisted:houston:freeposter_dismissed", "1"); } catch {}
  };

  const toggleCheck = (id: number) => setChecked((prev) => (prev.includes(id) ? prev.filter((x) => x !== id) : [...prev, id]));
  const toggleExpand = (id: number) => setExpanded((prev) => (prev.includes(id) ? prev.filter((x) => x !== id) : [...prev, id]));

  const count = checked.length;
  const max = ITEMS.length;
  const pct = Math.round((count / max) * 100) || 0;

  const shareList = async () => {
    const url = makeProgressURL([]);
    if (navigator.share) { try { await navigator.share({ title: "Houston Bucket List", text: "Houston Bucket List", url }); } catch {}
    } else if (navigator.clipboard) { await navigator.clipboard.writeText(url); alert("List URL copied to clipboard"); }
  };
  const shareMyProgress = async () => {
    const url = makeProgressURL(checked);
    const text = `I've checked ${count}/${max} on the Houston Bucket List!`;
    if (navigator.share) { try { await navigator.share({ title: "My Houston progress", text, url }); } catch {}
    } else if (navigator.clipboard) { await navigator.clipboard.writeText(url); alert("Your progress link is copied to clipboard"); }
  };

  const filtered = ITEMS.filter((it) => {
    if (showFilter === "todo") return !checked.includes(it.id);
    if (showFilter === "done") return checked.includes(it.id);
    return true;
  });

  return (
    <div className="min-h-screen bg-slate-50 text-slate-900">
      {/* ================================= Hero ================================= */}
      <header className="relative isolate overflow-hidden min-h-[40vh] md:min-h-[45vh]">
        <div className="absolute inset-0 -z-10">
          {/* Replace with real travel photo via CSS background-image on production */}
          <div className="absolute inset-0 bg-gradient-to-tr from-[#EC555C]/25 via-[#3B82F6]/20 to-transparent" />
          <div className="absolute inset-0 bg-black/40" />
        </div>
        <div className="mx-auto flex h-full max-w-7xl flex-col items-center justify-center px-4 py-6 text-center md:py-10">
          <div className="space-y-2">
            <h1 className="text-4xl md:text-6xl font-extrabold tracking-tight text-white drop-shadow-sm">Houston Bucket List</h1>
            <div className="mx-auto inline-flex items-center gap-2 rounded-full bg-[#EC555C] px-4 py-1 text-sm font-extrabold text-white shadow md:text-base">
              60 Best Things To Do in Houston
            </div>
            {/* Elevator line only (no intro card) */}
            <div className="text-white/95 text-sm md:text-base">A curated mix of icons + local gems, optimized for a weekend.</div>
          </div>
        </div>
      </header>

      {/* ================================= Main ================================= */}
      <main className="mx-auto grid max-w-7xl grid-cols-1 gap-6 px-4 py-6 md:grid-cols-12">
        {/* Left column */}
        <section className="md:col-span-8 lg:col-span-9">
          {/* Toolbar: Show (left) + View (right) — unified styles */}
          <div className="mb-4 flex flex-wrap items-center justify-between gap-3">
            <div className="relative">
              <div className={ui.group}>
                <button onClick={() => setShowMenu((s) => !s)} className={cx(ui.btnBase, ui.btnBrand, ui.left)}>
                  Show: {showFilter === "all" ? "All" : showFilter === "todo" ? "To do" : "Done"}
                </button>
                <button onClick={() => setShowMenu((s) => !s)} className={cx(ui.btnBase, ui.btnBrand, ui.right)} aria-label="More show options">▼</button>
              </div>
              {showMenu && (
                <div className="absolute left-0 z-10 mt-2 w-40 overflow-hidden rounded-xl border bg-white shadow">
                  <button onClick={() => { setShowFilter("all"); setShowMenu(false); }} className="block w-full px-3 py-2 text-left text-sm hover:bg-slate-50">All</button>
                  <button onClick={() => { setShowFilter("todo"); setShowMenu(false); }} className="block w-full px-3 py-2 text-left text-sm hover:bg-slate-50">To do</button>
                  <button onClick={() => { setShowFilter("done"); setShowMenu(false); }} className="block w-full px-3 py-2 text-left text-sm hover:bg-slate-50">Done</button>
                </div>
              )}
            </div>

            <div className="flex items-center gap-2 text-sm">
              <div className={ui.group}>
                <button className={cx(ui.btnBase, view === "compact" ? ui.btnActive : ui.btnBrand, ui.left)} onClick={() => setView("compact")}>Compact</button>
                <button className={cx(ui.btnBase, view === "expanded" ? ui.btnActive : ui.btnBrand, ui.right)} onClick={() => setView("expanded")}>Expanded</button>
              </div>
            </div>
          </div>

          {/* List */}
          <ol className="space-y-3 md:space-y-4">
            {filtered.map((item) => {
              const isChecked = checked.includes(item.id);
              const isOpen = expanded.includes(item.id);
              const number = ITEMS.findIndex((i) => i.id === item.id) + 1;

              return (
                <li key={item.id} className="rounded-2xl border border-slate-200 bg-white p-3 md:p-4 shadow-sm">
                  <div className="flex items-start gap-3">
                    {/* Checkbox coral */}
                    <input
                      type="checkbox"
                      className="mt-1 h-5 w-5 shrink-0 rounded border-slate-300 text-[#EC555C] accent-[#EC555C] focus:ring-[#EC555C]"
                      checked={isChecked}
                      onChange={() => toggleCheck(item.id)}
                      aria-label={`Mark ${item.title} done`}
                    />
                    {/* Rank badge — blue with white text */}
                    <div className="flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-[#3B82F6] text-white shadow-sm ring-1 ring-black/5 font-extrabold text-base md:text-lg">
                      {number}
                    </div>
                    <div className="min-w-0 flex-1">
                      <div className="grid grid-cols-[1fr_auto] grid-rows-[auto_auto] items-center gap-x-3 gap-y-1">
                        <button className="col-start-1 row-start-1 flex w-full items-center justify-between gap-2 text-left" onClick={() => toggleExpand(item.id)}>
                          <h3 className={`truncate text-base md:text-lg font-semibold ${isChecked ? "line-through decoration-2" : ""}`}>{item.title}</h3>
                          <svg className={`h-5 w-5 transition-transform ${isOpen ? "rotate-180" : ""}`} viewBox="0 0 20 20" fill="currentColor"><path d="M5.23 7.21a.75.75 0 011.06.02L10 11.06l3.71-3.83a.75.75 0 111.08 1.04l-4.25 4.4a.75.75 0 01-1.08 0l-4.25-4.4a.75.75 0 01.02-1.06z"/></svg>
                        </button>
                        {/* Right-aligned square thumb when collapsed */}
                        <div className={`hidden sm:block self-center row-span-2 ${isOpen ? "opacity-0" : "opacity-100"}`}>
                          <div className="h-16 w-16 rounded-lg bg-slate-100" />
                        </div>
                        {/* Tight excerpt */}
                        <p className="col-start-1 row-start-2 mt-0 text-sm leading-tight text-slate-600 line-clamp-2">{item.excerpt}</p>
                      </div>
                      {/* Expanded content */}
                      {isOpen && (
                        <div className="mt-3 grid gap-3 md:grid-cols-3">
                          <div className="md:col-span-2">
                            <div className="h-48 w-full rounded-xl bg-slate-100" />
                            <div className="mt-3 space-y-2 text-sm text-slate-700">
                              <p>Why it's on the list: succinct, persuasive blurb explaining the appeal and best-time-to-go tips.</p>
                              <div className="flex flex-wrap gap-2">
                                <a href="#" className="rounded-lg border px-3 py-2 hover:bg-slate-50 text-[#3B82F6]">Read more</a>
                                <a href="#" className="rounded-lg border px-3 py-2 hover:bg-slate-50 text-[#3B82F6]">Get directions</a>
                              </div>
                            </div>
                          </div>
                        </div>
                      )}
                    </div>
                  </div>
                </li>
              );
            })}
          </ol>
        </section>

        {/* Right rail */}
        <aside className="md:col-span-4 lg:col-span-3">
          <div className="sticky top-4 space-y-4">
            {/* Progress Pill — now the first right-rail card */}
            <div className="rounded-2xl border border-slate-200 bg-white p-4 shadow-sm">
              <div className="flex items-center justify-between gap-3">
                <div className="inline-flex items-center gap-2">
                  <ProgressRing pct={pct} />
                  <div className="text-sm font-semibold text-slate-900">{count}/{max}</div>
                </div>
                <div className="relative">
                  <div className={ui.group}>
                    <button onClick={() => (count ? shareMyProgress() : shareList())} className={cx(ui.btnBase, ui.btnBrand, ui.left)}>
                      Share {count ? "my progress" : "list"}
                    </button>
                    <button onClick={() => setShareMenu((s) => !s)} className={cx(ui.btnBase, ui.btnBrand, ui.right)} aria-label="More share options">▼</button>
                  </div>
                  {shareMenu && (
                    <div className="absolute right-0 z-10 mt-2 w-52 overflow-hidden rounded-xl border bg-white shadow">
                      <button onClick={shareList} className="block w-full px-3 py-2 text-left text-sm hover:bg-slate-50">Share list (blank)</button>
                      <button onClick={shareMyProgress} className="block w-full px-3 py-2 text-left text-sm hover:bg-slate-50">Share my progress</button>
                      <button onClick={() => setShowPreview(true)} className="block w-full px-3 py-2 text-left text-sm hover:bg-slate-50">Preview social image</button>
                    </div>
                  )}
                </div>
              </div>
            </div>

            {/* Map (lazy in prod) */}
            <div id="map" className="rounded-2xl border border-slate-200 bg-white p-4 shadow-sm">
              <div className="mb-2 font-semibold">Map</div>
              <div className="h-56 w-full rounded-xl bg-slate-100" />
              <p className="mt-2 text-xs text-slate-600">Map loads only when viewed in production for max performance.</p>
            </div>

            {/* Explore more in Houston */}
            <div className="rounded-2xl border border-slate-200 bg-white p-4 shadow-sm">
              <div className="mb-2 font-semibold">Explore more in Houston</div>
              <ul className="space-y-2 text-sm">
                <li><a className="text-[#3B82F6] hover:underline" href="#">12 Free Things To Do in Houston</a></li>
                <li><a className="text-[#3B82F6] hover:underline" href="#">Romantic Things To Do in Houston</a></li>
                <li><a className="text-[#3B82F6] hover:underline" href="#">Houston with Kids</a></li>
              </ul>
            </div>

            {/* Store promos */}
            <div id="store" className="space-y-4">
              <div className="rounded-2xl border border-rose-200 bg-white p-4 shadow-sm">
                <div className="mb-2 font-semibold">Personalized Poster</div>
                <div className="mb-3"><PosterCard /></div>
                <ul className="mb-3 list-inside list-disc text-sm text-slate-700">
                  <li>Add your name or dedication</li>
                  <li>Optional frame</li>
                  <li>Ships fast</li>
                </ul>
                <button className="w-full rounded-lg bg-[#EC555C] py-2 text-sm font-semibold text-white hover:opacity-90">Preview my poster</button>
              </div>

              <div className="rounded-2xl border border-purple-200 bg-white p-4 shadow-sm">
                <div className="mb-2 font-semibold">The Gift Bundle <span className="ml-2 rounded bg-purple-50 px-2 py-0.5 text-xs text-purple-700">Most popular</span></div>
                <ul className="mb-3 list-inside list-disc text-sm text-slate-700">
                  <li>Poster + Pocket Book</li>
                  <li>Gift note card included</li>
                  <li>Personalize recipient name</li>
                  <li>Ready-to-gift sleeve</li>
                </ul>
                <div className="mb-2 text-xs text-slate-600">Great for birthdays • housewarmings • graduations</div>
                <button className="w-full rounded-lg bg-purple-600 py-2 text-sm font-semibold text-white hover:bg-purple-700">Get the bundle</button>
              </div>

              <div className="rounded-2xl border border-amber-200 bg-white p-4 shadow-sm">
                <div className="mb-2 font-semibold">Limited‑Edition Houston Print</div>
                <div className="text-sm text-slate-700">Numbered run, archival inks, optional frame. 30‑day returns.</div>
                <button className="mt-3 w-full rounded-lg bg-amber-600 py-2 text-sm font-semibold text-white hover:bg-amber-700">See sizes & frames</button>
              </div>
            </div>
          </div>
        </aside>
      </main>

      {/* ========================== Email capture popover ========================== */}
      {showPopover && (
        <div className="fixed inset-0 z-[60] flex items-center justify-center bg-black/50 p-4">
          <div className="w-full max-w-md rounded-2xl bg-white p-5 shadow-2xl">
            <div className="mb-2 text-lg font-extrabold">FREE Poster + Travel Guide</div>
            <p className="text-sm text-slate-600">Get a printable Houston poster and a quick-start weekend guide. We'll send it right to your inbox.</p>
            <div className="mt-3 flex gap-2">
              <input className="flex-1 rounded-lg border px-3 py-2" placeholder="you@example.com" />
              <button className="rounded-lg bg-emerald-600 px-4 py-2 text-sm font-semibold text-white">Send</button>
            </div>
            <div className="mt-3 text-center text-xs text-slate-500">
              <button onClick={dismissPopover} className="underline">No thanks</button>
            </div>
          </div>
        </div>
      )}

      {/* =============================== Social preview =============================== */}
      {showPreview && (
        <div className="fixed inset-0 z-[70] flex items-center justify-center bg-black/50 p-4" onClick={() => setShowPreview(false)}>
          <div className="w-full max-w-2xl rounded-2xl bg-white p-5 shadow-2xl" onClick={(e) => e.stopPropagation()}>
            <div className="mb-3 text-lg font-extrabold">Share preview</div>
            <div className="relative overflow-hidden rounded-xl border bg-white">
              <div className="aspect-[1200/630] bg-gradient-to-tr from-[#FDECF0] via-white to-[#EAF2F8] p-6">
                <div className="flex h-full items-center justify-between">
                  <div className="space-y-2">
                    <div className="inline-flex items-center gap-2 rounded-full bg-[#EC555C] px-3 py-1 text-sm font-extrabold text-white">Houston Bucket List</div>
                    <div className="text-3xl font-black text-slate-900">{count}/{max} completed</div>
                  </div>
                  <div className="flex items-center gap-3">
                    <ProgressRing pct={pct} size={80} stroke={8} />
                    <div className="text-4xl font-extrabold text-slate-900">{pct}%</div>
                  </div>
                </div>
              </div>
            </div>
            <div className="mt-3 flex justify-end gap-2">
              <button className="rounded-lg border px-3 py-2 text-sm" onClick={() => setShowPreview(false)}>Close</button>
              <button className="rounded-lg bg-slate-900 px-3 py-2 text-sm font-semibold text-white" onClick={() => setShowPreview(false)}>Looks good</button>
            </div>
          </div>
        </div>
      )}

      {/* ============================== Mobile action dock ============================== */}
      <div className="fixed inset-x-0 bottom-0 z-50 border-t border-slate-200 bg-white/95 backdrop-blur md:hidden">
        <div className="mx-auto max-w-3xl px-3 py-2">
          <div className="flex items-center justify-between gap-2">
            {/* Progress pill becomes the mobile anchor (full) */}
            <div className="inline-flex items-center gap-2">
              <ProgressRing pct={pct} />
              <span className="text-sm font-semibold">{count}/{max}</span>
            </div>
            <div className="relative">
              <div className={ui.group}>
                <button onClick={() => (count ? shareMyProgress() : shareList())} className={cx(ui.btnBase, ui.btnBrand, ui.left)}>
                  Share {count ? "my progress" : "list"}
                </button>
                <button onClick={() => setShareMenu((s) => !s)} className={cx(ui.btnBase, ui.btnBrand, ui.right)} aria-label="More share options">▼</button>
              </div>
              {shareMenu && (
                <div className="absolute right-0 z-10 -top-1 -translate-y-full w-52 overflow-hidden rounded-xl border bg-white shadow">
                  <button onClick={shareList} className="block w-full px-3 py-2 text-left text-sm hover:bg-slate-50">Share list (blank)</button>
                  <button onClick={shareMyProgress} className="block w-full px-3 py-2 text-left text-sm hover:bg-slate-50">Share my progress</button>
                  <button onClick={() => setShowPreview(true)} className="block w-full px-3 py-2 text-left text-sm hover:bg-slate-50">Preview social image</button>
                </div>
              )}
            </div>
          </div>
        </div>
      </div>

      <footer className="pb-20 md:pb-8" />
    </div>
  );
}


window.HoustonListTemplateMock = HoustonListTemplateMock;


// ==== bucketlisted_fort_mc_henry_improved_mockup.jsx ====


function BucketlistedDesktopOnly() {
  // Lightweight runtime checks (acts as smoke tests in this sandbox)
  useEffect(() => {
    if (typeof window === 'undefined') return;
    try {
      console.assert(!!document.querySelector('header'), 'Header renders');
      console.assert(!!document.querySelector('section'), 'At least one section renders');
      console.assert(!!document.querySelector('#guide'), 'Guide section renders');
      console.assert(!!document.querySelector('#faq'), 'FAQ section renders');
      console.assert(!!document.querySelector('#tips'), 'Tips section renders');
    } catch {}
  }, []);

  return (
    <div className="min-h-screen bg-neutral-50 text-neutral-900">
      <div className="mx-auto max-w-7xl p-4">
        <h1 className="text-xl font-black tracking-tight mb-3">Bucketlisted — Place Page (Desktop Only)</h1>
        <div className="rounded-2xl border border-neutral-200 bg-white shadow-sm overflow-hidden">
          <div className="bg-neutral-100 text-xs text-neutral-600 px-3 py-2">Desktop preview</div>
          <DesktopMock />
        </div>
      </div>
    </div>
  );
}

function DesktopMock() {
  const [guideExpanded, setGuideExpanded] = useState(false);
  const [showVisit, setShowVisit] = useState(false);
  const [showSave, setShowSave] = useState(false);
  const [isComplete, setIsComplete] = useState(false);
  const [visits, setVisits] = useState<any[]>([]);
  const [editVisit, setEditVisit] = useState<any>(null);
  const [showBeenOptions, setShowBeenOptions] = useState(false);
  const [showManageVisits, setShowManageVisits] = useState(false);
  const [expandedVisitId, setExpandedVisitId] = useState<number | null>(null);

  return (
    <div className="min-h-[70vh]">
      {/* Header (desktop) */}
      <header className="sticky top-0 z-30 bg-white/90 backdrop-blur border-b border-neutral-200">
        <div className="mx-auto max-w-6xl px-5 h-16 grid grid-cols-3 items-center">
          {/* Left: Logo */}
          <div className="flex items-center gap-3">
            <span className="inline-flex h-8 w-8 items-center justify-center rounded-lg bg-rose-600 text-white font-bold">✓</span>
            <a href="#" className="text-lg font-black tracking-tight">BUCKETLISTED</a>
          </div>
          {/* Center: Primary menu (centered, equal style) */}
          <nav className="justify-center flex items-center gap-8 text-sm font-extrabold text-neutral-800">
            <a className="hover:text-neutral-900" href="#">Places</a>
            <a className="hover:text-neutral-900" href="#">Nearby</a>
            <a className="hover:text-neutral-900" href="#">Saved</a>
          </nav>
          {/* Right: empty for balance */}
          <div></div>
        </div>
      </header>

      {/* Hero */}
      <section className="relative">
        <div className="relative h-[60vh] w-full bg-[radial-gradient(ellipse_at_center,_var(--tw-gradient-stops))] from-rose-200 via-rose-300 to-rose-500">
          {/* Center the hero content vertically within the hero image */}
          <div className="absolute inset-0 flex items-center">
            <div className="mx-auto max-w-6xl px-5 w-full">
              <div className="max-w-3xl mx-auto text-center">
                {/* Place badge */}
                <div className="inline-flex items-center gap-2 rounded-full bg-white/90 px-3 py-1 text-xs font-semibold text-neutral-700 ring-1 ring-black/5 mx-auto">
                  <span className="inline-flex h-5 w-5 items-center justify-center rounded-full bg-rose-600 text-white text-[10px]">FM</span>
                  Anthem Fort
                </div>
                <h1 className="mt-2 text-6xl font-black leading-[0.95] text-white drop-shadow">Fort McHenry</h1>
                {/* Red subtitle bar */}
                <div className="mt-2 inline-block rounded-full bg-rose-600 text-white px-4 py-2 text-sm font-extrabold tracking-wide">HOME OF THE NATIONAL ANTHEM</div>

                {/* CTA row (in-hero) */}
                <div className="mt-4 flex flex-wrap items-center justify-center gap-3">
                  <button
                    onClick={() => { if (!isComplete) { setIsComplete(true); } else { setShowBeenOptions(true); } }}
                    className={`h-14 px-5 rounded-2xl font-semibold shadow-sm inline-flex items-center gap-2 ${isComplete ? 'bg-neutral-900 text-white' : 'bg-white text-neutral-900'}`}
                  >
                    <BookmarkCheck className="h-5 w-5"/> I’ve Been
                  </button>
                  <button className="h-14 px-5 rounded-2xl bg-white text-neutral-900 font-semibold shadow-sm inline-flex items-center gap-2"><Navigation2 className="h-5 w-5"/> Go</button>
                  <button onClick={()=>{setEditVisit(null); setShowSave(true);}} className="h-14 px-5 rounded-2xl bg-white text-neutral-900 font-semibold shadow-sm inline-flex items-center gap-2"><Heart className="h-5 w-5"/> Save to…</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      {/* Featured Visits Bubble (shown only when checked off) */}
      {isComplete && (
        <section className="mx-auto max-w-6xl px-5 -mt-6">
          <div className="rounded-2xl bg-white shadow-sm ring-1 ring-black/5 p-5">
            <div className="flex items-center justify-between gap-3 flex-wrap">
              <p className="text-xs font-semibold text-neutral-500 uppercase tracking-wide">Memories</p>
              <div className="flex items-center gap-2">
                <button onClick={()=>{setEditVisit(null); setShowVisit(true);}} className="rounded-xl bg-neutral-900 text-white px-3 py-2 text-sm font-semibold">Add visit</button>
                <button onClick={()=> setShowManageVisits(true)} className="rounded-xl border border-neutral-300 px-3 py-2 text-sm font-medium">Manage</button>
                <button className="rounded-xl border border-rose-200 bg-rose-50 text-rose-700 px-3 py-2 text-sm font-semibold">Create keepsake</button>
              </div>
            </div>

            {/* Inline visits list (if any) */}
            {visits.length > 0 ? (
              <ul className="mt-4 divide-y divide-neutral-200 rounded-xl bg-white ring-1 ring-neutral-200">
                {visits.map((v) => (
                  <li key={v.id} className="p-0">
                    <button
                      className="w-full text-left px-4 py-3 flex items-center justify-between gap-3 hover:bg-neutral-50"
                      onClick={() => setExpandedVisitId(expandedVisitId === v.id ? null : v.id)}
                    >
                      <div className="min-w-0">
                        <p className="text-sm font-semibold truncate">{v.dateLabel}{v.note ? ' • ' + v.note : ''}</p>
                        <div className="mt-1 flex items-center gap-1">
                          {(v.photos?.slice(0,3) || []).map((p: any, i: number)=> (
                            <img key={i} src={p.src} alt="" className="h-6 w-8 rounded-md object-cover"/>
                          ))}
                          {(!v.photos || v.photos.length===0) && [0,1,2].map((i)=> (
                            <span key={i} className="h-6 w-8 rounded-md bg-neutral-200"></span>
                          ))}
                        </div>
                      </div>
                      <div className="flex items-center gap-2">
                        <button onClick={(e)=>{ e.stopPropagation(); setEditVisit(v); setShowVisit(true); }} className="h-8 w-8 inline-flex items-center justify-center rounded-lg hover:bg-neutral-100" title="Edit">
                          <Pencil className="h-4 w-4"/>
                        </button>
                        <button onClick={(e)=>{ e.stopPropagation(); setVisits(prev=>prev.filter(x=>x.id!==v.id)); }} className="h-8 w-8 inline-flex items-center justify-center rounded-lg hover:bg-neutral-100" title="Delete">
                          <Trash2 className="h-4 w-4"/>
                        </button>
                      </div>
                    </button>
                    {expandedVisitId === v.id && (
                      <div className="px-4 pb-4">
                        <div className="mt-2 grid grid-cols-3 gap-2">
                          {(v.photos || []).slice(0,6).map((p: any, idx: number)=> (
                            <div key={idx} className="space-y-1">
                              <img src={p.src} alt="" className="aspect-[4/3] w-full rounded-lg object-cover bg-neutral-200"/>
                              {p.caption && <p className="text-xs text-neutral-600">{p.caption}</p>}
                            </div>
                          ))}
                          {(!v.photos || v.photos.length===0) && [0,1,2,3,4,5].map((i)=> (
                            <div key={i} className="aspect-[4/3] rounded-lg bg-neutral-200"></div>
                          ))}
                        </div>
                        {v.note && <p className="mt-3 text-sm text-neutral-700">{v.note}</p>}
                      </div>
                    )}
                  </li>
                ))}
              </ul>
            ) : (
              <div className="mt-3 rounded-xl border border-dashed border-neutral-300 p-3 text-sm text-neutral-600">No visits yet — add a quick note or photo to start your memories. It takes 10 seconds and helps other travelers.</div>
            )}
          </div>
        </section>
      )}

      {/* Local sub-nav */}
      <div className="sticky top-16 z-20 bg-white/90 backdrop-blur border-b border-neutral-200 mt-3">
        <div className="mx-auto max-w-6xl px-5 py-2 text-sm font-extrabold text-neutral-800 flex gap-6">
          <a href="#guide" className="hover:text-neutral-900">Guide</a>
          <a href="#faq" className="hover:text-neutral-900">FAQ</a>
          <a href="#tips" className="hover:text-neutral-900">Tips</a>
        </div>
      </div>

      {/* Guide */}
      <section id="guide" className="mt-6 rounded-2xl bg-white p-6 shadow-sm ring-1 ring-black/5">
        <p className="text-xs font-semibold text-neutral-500 uppercase tracking-wide">Overview</p>
        <div className={guideExpanded ? '' : 'max-h-32 overflow-hidden'}>
          <p className="mt-2 text-sm text-neutral-800">Where the Star-Spangled Banner was born: a compact fort with sweeping harbor views and living history. It’s an easy win—flat paths, open lawns, and a visitor film that sets the scene in under 15 minutes.</p>
          <p className="mt-2 text-sm text-neutral-800">Start at the visitor center for your map, then follow the ramp to the east wall for the best harbor vantage. Time your visit for a flag raising or lowering—the ranger talk turns the place into a story you’ll remember.</p>
          <p className="mt-2 text-sm text-neutral-800">For a slower visit, circle the star-shaped ramparts clockwise and watch ships move in and out of the Patapsco.</p>
        </div>
        {!guideExpanded && (
          <div className="mt-2">
            <button
              onClick={()=>setGuideExpanded(true)}
              className="inline-flex items-center gap-1 text-sm font-medium text-neutral-600 hover:text-neutral-800 underline underline-offset-2 decoration-neutral-300 hover:decoration-neutral-400"
            >Read more <ChevronRight className="h-4 w-4"/></button>
          </div>
        )}
        {guideExpanded && (
          <div className="mt-4">
            <div className="mb-3 text-sm">
              <strong>In this guide</strong>
              <ul className="list-disc pl-5 mt-1 space-y-1">
                <li>History & context</li>
                <li>What to see</li>
                <li>Getting there & parking</li>
                <li>Accessibility</li>
              </ul>
            </div>
            <p className="text-sm text-neutral-800">Long-form guide content would live here. For this demo, the TOC shows how sections would be organized once expanded.</p>
            <div className="mt-3 text-right">
              <button onClick={()=>setGuideExpanded(false)} className="inline-flex items-center gap-1 text-sm font-medium text-neutral-600 hover:text-neutral-800 underline underline-offset-2 decoration-neutral-300 hover:decoration-neutral-400">Collapse guide</button>
            </div>
          </div>
        )}
      </section>

      {/* FAQ */}
      <section id="faq" className="mt-6 rounded-2xl bg-white p-6 shadow-sm ring-1 ring-black/5">
        <p className="text-xs font-semibold text-neutral-500 uppercase tracking-wide">Popular Q&amp;A</p>

        <details className="mt-3 border-t border-neutral-200 pt-3">
          <summary className="cursor-pointer font-semibold">What’s new? <span className="ml-2 inline-flex items-center rounded-full bg-neutral-900 text-white text-[11px] px-2 py-[1px]">Updated today</span></summary>
          <ul className="mt-2 list-disc pl-5 space-y-1 text-sm">
            <li>Sunset flag lowering 6:30pm (Fri–Sun)</li>
            <li>Temporary exhibit: War of 1812</li>
            <li>Harbor shuttle every 20 minutes</li>
          </ul>
        </details>

        <details className="mt-3 border-t border-neutral-200 pt-3">
          <summary className="cursor-pointer font-semibold">What are the hours? <span className="text-neutral-500 font-normal">— 9:00–17:00 (daily)</span></summary>
          <p className="mt-2 text-sm">Hours may vary for holidays and special events; check the official site before you go.</p>
        </details>

        <details className="mt-3 border-t border-neutral-200 pt-3">
          <summary className="cursor-pointer font-semibold">How much does it cost? <span className="text-neutral-500 font-normal">— $15 adults · kids free</span></summary>
          <p className="mt-2 text-sm">Admission covers the fort and visitor center exhibits; special tours may be extra.</p>
        </details>

        <details className="mt-3 border-t border-neutral-200 pt-3">
          <summary className="cursor-pointer font-semibold">Where do I park? <span className="text-neutral-500 font-normal">— On-site lot + overflow</span></summary>
          <p className="mt-2 text-sm">Lots can fill on weekends by mid-day; arrive early or consider rideshare.</p>
        </details>

        <details className="mt-3 border-t border-neutral-200 pt-3">
          <summary className="cursor-pointer font-semibold">Is it accessible? <span className="text-neutral-500 font-normal">— Flat paths; accessible restrooms</span></summary>
          <p className="mt-2 text-sm">Most ramparts have graded access; some historic areas may have uneven surfaces.</p>
        </details>

        {/* Ask a question at the bottom */}
        <div className="mt-4">
          <div className="flex items-center rounded-xl border border-neutral-300 px-3 py-2 text-sm">
            <span className="text-neutral-400 mr-2"><HelpCircle className="h-4 w-4"/></span>
            <input className="flex-1 outline-none bg-transparent" placeholder="Ask a question…" />
            <button className="ml-2 rounded-lg bg-neutral-900 text-white px-3 py-1 text-sm font-semibold">Ask</button>
          </div>
        </div>
      </section>

      {/* Tips */}
      <section id="tips" className="mt-6 rounded-2xl bg-white p-6 shadow-sm ring-1 ring-black/5">
        <p className="text-xs font-semibold text-neutral-500 uppercase tracking-wide">Travel Tips</p>
        <ul className="mt-3 list-disc pl-5 space-y-1 text-sm">
          <li>Arrive 30 min before sunset for the lowering ceremony and best light.</li>
          <li>Wind picks up on the ramparts—bring a light jacket even in summer.</li>
          <li>Stroller route: enter via visitor center, ramp to east wall loop.</li>
        </ul>
      </section>

      {/* Nearby */}
      <section className="mt-6 rounded-2xl bg-white p-6 shadow-sm ring-1 ring-black/5">
        <div className="flex items-center gap-2 mb-2"><Map className="h-5 w-5 text-rose-600"/><h2 className="text-lg font-bold">Nearby</h2></div>
        <div className="h-44 rounded-xl bg-neutral-100 ring-1 ring-neutral-200 flex items-center justify-center text-neutral-500 text-sm">Map placeholder</div>
        <div className="mt-3 grid md:grid-cols-3 gap-3">
          <NearbyCard title="Museum of Industry" meta="8 min away • 45–60 min"/>
          <NearbyCard title="Federal Hill Park" meta="6 min away • 20–40 min"/>
          <NearbyCard title="Inner Harbor Promenade" meta="10 min away • 30–90 min"/>
        </div>
      </section>

      {/* Modals */}
      {showVisit && (
        <VisitModal
          initial={editVisit}
          onSave={(data)=>{
            if (editVisit) {
              setVisits(prev=>prev.map(v=> v.id===editVisit.id ? {...editVisit, ...data} : v));
            } else {
              const id = Date.now();
              setVisits(prev=>[{ id, ...data }, ...prev]);
            }
            setIsComplete(true);
            setEditVisit(null);
            setShowVisit(false);
          }}
          onClose={()=>{ setEditVisit(null); setShowVisit(false); }}
        />
      )}
      {showSave && <SaveModal onClose={()=>setShowSave(false)} />}
      {showBeenOptions && (
        <BeenOptionsModal
          onAddAnother={() => { setShowBeenOptions(false); setEditVisit(null); setShowVisit(true); }}
          onManage={() => { setShowBeenOptions(false); setShowManageVisits(true); }}
          onUncheck={() => { setShowBeenOptions(false); setIsComplete(false); }}
          onClose={() => setShowBeenOptions(false)}
        />
      )}
      {showManageVisits && (
        <ManageVisitsModal
          visits={visits}
          onEdit={(v)=>{ setEditVisit(v); setShowManageVisits(false); setShowVisit(true); }}
          onDelete={(id)=>{ setVisits(prev=>prev.filter(x=>x.id!==id)); }}
          onClose={()=> setShowManageVisits(false)}
        />
      )}

      <footer className="mt-10 border-t border-neutral-200 py-8 text-sm text-neutral-600 text-center">© {new Date().getFullYear()} Bucketlisted</footer>
    </div>
  );
}

function NearbyCard({ title, meta }:{ title: string; meta: string; }){
  return (
    <div className="rounded-xl ring-1 ring-neutral-200 bg-white px-4 py-3 shadow-sm">
      <p className="font-semibold">{title}</p>
      <p className="text-sm text-neutral-600">{meta}</p>
    </div>
  );
}

function VisitModal({ onClose, onSave, initial }:{ onClose: ()=>void; onSave: (p:any)=>void; initial: any }){
  const [dateChoice, setDateChoice] = useState(initial?.dateChoice || 'Today');
  const [timeChoice, setTimeChoice] = useState(initial?.timeChoice || '60');
  const [note, setNote] = useState(initial?.note || '');
  const [photos, setPhotos] = useState<any[]>(initial?.photos || []);
  const dateOptions = ['Today','This week','Pick date'];
  const timeOptions = ['15','30','60','90','120+'];

  function onFilesSelected(e:any){
    const files = Array.from(e.target.files || []).slice(0,6);
    Promise.all(files.map((f:any)=> new Promise((res,rej)=>{ const fr=new FileReader(); fr.onload=()=>res({src:fr.result as string, caption:''}); fr.onerror=rej; fr.readAsDataURL(f);})))
      .then((items:any)=> setPhotos(items))
      .catch(()=>{});
  }
  function updateCaption(i:number, val:string){ setPhotos(prev=> prev.map((p,idx)=> idx===i? {...p, caption:val} : p)); }

  return (
    <div className="fixed inset-0 z-[100]">
      <div className="absolute inset-0 bg-black/40" onClick={onClose}></div>
      <div className="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-lg rounded-2xl bg-white shadow-2xl ring-1 ring-black/10">
        <div className="flex items-center justify-between p-4 border-b border-neutral-200">
          <p className="text-sm font-semibold">{initial ? 'Edit visit' : 'Add visit'}</p>
          <button onClick={onClose} className="h-8 w-8 inline-flex items-center justify-center rounded-lg hover:bg-neutral-100"><X className="h-4 w-4"/></button>
        </div>
        <div className="p-4 grid gap-3 text-sm">
          <div>
            <p className="text-xs text-neutral-500">When did you go?</p>
            <div className="mt-1 grid grid-cols-3 gap-2">
              {dateOptions.map((x)=> (
                <button key={x} onClick={()=>setDateChoice(x)} className={`rounded-xl border px-3 py-2 ${dateChoice===x? 'border-neutral-900' : 'border-neutral-300'}`}>{x}</button>
              ))}
            </div>
          </div>
          <div>
            <p className="text-xs text-neutral-500">Time spent</p>
            <div className="mt-1 grid grid-cols-5 gap-2">
              {timeOptions.map((x)=> (
                <button key={x} onClick={()=>setTimeChoice(x)} className={`rounded-xl border px-3 py-2 ${timeChoice===x? 'border-neutral-900' : 'border-neutral-300'}`}>{x}m</button>
              ))}
            </div>
          </div>
          <div>
            <p className="text-xs text-neutral-500">Notes</p>
            <textarea value={note} onChange={(e)=>setNote(e.target.value)} className="w-full rounded-xl border border-neutral-300 p-2" rows={3} maxLength={140} placeholder="140 characters…"/>
          </div>

          <div>
            <p className="text-xs text-neutral-500">Photos & captions (optional)</p>
            <input type="file" accept="image/*" multiple onChange={onFilesSelected} className="mt-1"/>
            {photos.length > 0 && (
              <div className="mt-2 grid grid-cols-3 gap-2">
                {photos.map((p, idx)=> (
                  <div key={idx} className="space-y-1">
                    <img src={p.src} alt="" className="aspect-[4/3] w-full rounded-xl object-cover bg-neutral-100 ring-1 ring-neutral-200"/>
                    <input value={(p as any).caption} onChange={(e)=>updateCaption(idx, (e.target as HTMLInputElement).value)} className="w-full rounded-lg border border-neutral-300 p-1 text-xs" placeholder="Caption (optional)"/>
                  </div>
                ))}
              </div>
            )}
          </div>

          <div className="grid grid-cols-2 gap-2 mt-1">
            <button
              className="rounded-xl bg-neutral-900 text-white px-3 py-2 text-sm font-semibold"
              onClick={() => {
                const payload = {
                  id: initial?.id || Date.now(),
                  dateLabel: dateChoice,
                  dateChoice,
                  timeSpent: timeChoice,
                  timeChoice,
                  note: note.trim(),
                  photos
                };
                onSave && onSave(payload);
              }}
            >{initial ? 'Save changes' : 'Save visit'}</button>
            <button className="rounded-xl border border-neutral-300 px-3 py-2 text-sm font-medium" onClick={onClose}>Cancel</button>
          </div>
        </div>
      </div>
    </div>
  );
}

function SaveModal({ onClose }:{ onClose: ()=>void }){
  return (
    <div className="fixed inset-0 z-[100]">
      <div className="absolute inset-0 bg-black/40" onClick={onClose}></div>
      <div className="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-md rounded-2xl bg-white shadow-2xl ring-1 ring-black/10">
        <div className="flex items-center justify-between p-4 border-b border-neutral-200">
          <p className="text-sm font-semibold">Save to…</p>
          <button onClick={onClose} className="h-8 w-8 inline-flex items-center justify-center rounded-lg hover:bg-neutral-100"><X className="h-4 w-4"/></button>
        </div>
        <div className="p-4 grid gap-2">
          <button className="flex items-center justify-between rounded-xl border border-neutral-200 px-3 py-3 text-sm"><span>Bucket List (default)</span><BookmarkCheck className="h-5 w-5"/></button>
          <button className="flex items-center justify-between rounded-xl border border-neutral-200 px-3 py-3 text-sm"><span>Baltimore Weekend</span></button>
          <button className="flex items-center justify-between rounded-xl border border-neutral-200 px-3 py-3 text-sm"><span>Stadium Tour</span></button>
          <button className="flex items-center justify-center gap-2 rounded-xl bg-neutral-100 px-3 py-3 text-sm font-medium"><Plus className="h-4 w-4"/> Create new list</button>
          <div className="grid grid-cols-2 gap-2 mt-1">
            <button className="rounded-xl bg-neutral-900 text-white px-3 py-2 text-sm font-semibold" onClick={onClose}>Done</button>
            <button className="rounded-xl border border-neutral-300 px-3 py-2 text-sm font-medium" onClick={onClose}>Cancel</button>
          </div>
        </div>
      </div>
    </div>
  );
}

function BeenOptionsModal({ onAddAnother, onManage, onUncheck, onClose }:{ onAddAnother: ()=>void; onManage: ()=>void; onUncheck: ()=>void; onClose: ()=>void; }){
  return (
    <div className="fixed inset-0 z-[110]">
      <div className="absolute inset-0 bg-black/40" onClick={onClose}></div>
      <div className="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-sm rounded-2xl bg-white shadow-2xl ring-1 ring-black/10 p-4">
        <p className="text-sm font-semibold mb-3">What would you like to do?</p>
        <div className="grid gap-2 text-sm">
          <button onClick={onAddAnother} className="rounded-xl border border-neutral-300 px-3 py-2 text-left">Add another visit</button>
          <button onClick={onManage} className="rounded-xl border border-neutral-300 px-3 py-2 text-left">Manage visits</button>
          <button onClick={onUncheck} className="rounded-xl border border-neutral-300 px-3 py-2 text-left">Remove checkmark</button>
          <button onClick={onClose} className="rounded-xl bg-neutral-900 text-white px-3 py-2 font-semibold">Cancel</button>
        </div>
      </div>
    </div>
  );
}

function ManageVisitsModal({ visits, onEdit, onDelete, onClose }:{ visits:any[]; onEdit:(v:any)=>void; onDelete:(id:number)=>void; onClose: ()=>void; }){
  return (
    <div className="fixed inset-0 z-[120]">
      <div className="absolute inset-0 bg-black/40" onClick={onClose}></div>
      <div className="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-lg rounded-2xl bg-white shadow-2xl ring-1 ring-black/10">
        <div className="flex items-center justify-between p-4 border-b border-neutral-200">
          <p className="text-sm font-semibold">Manage visits</p>
          <button onClick={onClose} className="h-8 w-8 inline-flex items-center justify-center rounded-lg hover:bg-neutral-100"><X className="h-4 w-4"/></button>
        </div>
        <div className="p-4 grid gap-2">
          {visits.length === 0 ? (
            <p className="text-sm text-neutral-600">No visits yet.</p>
          ) : (
            visits.map((v)=> (
              <div key={v.id} className="flex items-center justify-between rounded-xl border border-neutral-200 px-3 py-2 text-sm">
                <div>
                  <p className="font-semibold">{v.dateLabel}</p>
                  {v.note && <p className="text-neutral-700">{v.note}</p>}
                </div>
                <div className="flex items-center gap-2">
                  <button onClick={()=>onEdit(v)} className="h-8 w-8 inline-flex items-center justify-center rounded-lg hover:bg-neutral-100" title="Edit"><Pencil className="h-4 w-4"/></button>
                  <button onClick={()=>onDelete(v.id)} className="h-8 w-8 inline-flex items-center justify-center rounded-lg hover:bg-neutral-100" title="Delete"><Trash2 className="h-4 w-4"/></button>
                </div>
              </div>
            ))
          )}
          <div className="mt-2 text-right">
            <button onClick={onClose} className="rounded-xl bg-neutral-900 text-white px-3 py-2 text-sm font-semibold">Done</button>
          </div>
        </div>
      </div>
    </div>
  );
}


window.BucketlistedDesktopOnly = BucketlistedDesktopOnly;


// ==== bucketlisted_fort_mc_henry_improved_mockup (1).jsx ====


// Brand checkbox icon to match Bucketlisted style
function BrandCheckIcon({ checked, className }:{ checked: boolean; className?: string }){
  return (
    <svg viewBox="0 0 24 24" className={className} aria-hidden="true">
      <rect x="2" y="2" width="20" height="20" rx="2" ry="2" fill={checked ? '#EC555C' : '#ffffff'} stroke="#111827" strokeWidth="2" />
      {checked && (
        <path d="M7 12.5l3 3 7-7" fill="none" stroke="#ffffff" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" />
      )}
    </svg>
  );
}

// ==========================================
// Shared UI tokens (aligned with List page)
// ==========================================
const ui = {
  group: "isolate inline-flex rounded-full shadow-sm",
  btnBase:
    "px-4 h-10 text-sm md:text-base font-semibold border transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#3B82F6]",
  btnBrand: "bg-white border-[#3B82F6] text-[#3B82F6] hover:bg-[#3B82F6] hover:text-white",
  btnActive: "bg-[#3B82F6] text-white border-[#3B82F6]",
  btnGhost: "px-3 h-9 md:h-10 text-sm font-semibold rounded-full border border-transparent text-[#3B82F6] hover:bg-[#3B82F6]/10",
  left: "rounded-l-full",
  right: "rounded-r-full",
  solo: "rounded-full",
};
const cx = (...parts: Array<string | false | undefined>) => parts.filter(Boolean).join(" ");

// --- Tiny pure helper + smoke tests ---
// group bursts of photos taken within a time window (ms) into one visit id
export function groupIntoVisits(timestamps: number[], windowMs: number): number[] {
  if (timestamps.length === 0) return [];
  const sorted = [...timestamps].sort((a,b)=>a-b);
  const groups: number[] = [0];
  for (let i=1;i<sorted.length;i++) {
    const prev = sorted[i-1];
    const curr = sorted[i];
    groups.push(curr - prev <= windowMs ? groups[groups.length-1] : groups[groups.length-1] + 1);
  }
  return groups;
}

function BucketlistedItemPolished() {
  // Existing smoke tests + a couple extra (do not remove)
  useEffect(() => {
    if (typeof window === 'undefined') return;
    try {
      console.assert(!!document.querySelector('header'), 'Header renders');
      // these sections should exist in DOM structure
      console.assert(!!document.querySelector('#guide'), 'Guide section renders');
      console.assert(!!document.querySelector('#faq'), 'FAQ section renders');
      console.assert(!!document.querySelector('#tips'), 'Tips section renders');
      // sub-nav presence
      const subnavLinks = document.querySelectorAll('.subnav-bar nav a');
      console.assert(subnavLinks.length >= 3, 'Sub-nav has items');
      console.assert(!document.querySelector('a[href="#visits"]'), 'Visits link hidden when not complete');
      // right rail/aside exists & is singular
      console.assert(document.querySelectorAll('aside').length === 1, 'One aside renders');
      console.assert(!!document.querySelector('aside .right-rail [data-test="type-tags"]'), 'Type & Tags card renders');
      console.assert(!!document.querySelector('aside .right-rail [data-test="location"]'), 'Location card renders');
      console.assert(document.querySelectorAll('aside .right-rail .store-promos .rounded-2xl').length === 3, 'Store promos render');
      // CTA row sanity
      console.assert(!!document.querySelector('.blp-cta-row button'), 'CTA row renders');
      console.assert(!!document.querySelector('a[href="#guide"]'), 'Guide link present');
      // pure function test (window of 2 minutes)
      const g = groupIntoVisits([0, 30_000, 60_000, 500_000], 120_000);
      console.assert(JSON.stringify(g) === JSON.stringify([0,0,0,1]), 'groupIntoVisits works');
    } catch {}
  }, []);

  return (
    <div className="min-h-screen bg-slate-50 text-slate-900">
      <ItemPage />
    </div>
  );
}

function ItemPage() {
  const [guideExpanded, setGuideExpanded] = useState(false);
  const [showVisit, setShowVisit] = useState(false);
  const [showSave, setShowSave] = useState(false);
  const [isComplete, setIsComplete] = useState(false);
  const [visits, setVisits] = useState<any[]>([]);
  const [editVisit, setEditVisit] = useState<any>(null);
  const [showBeenOptions, setShowBeenOptions] = useState(false);
  const [showManageVisits, setShowManageVisits] = useState(false);
  const [expandedVisitId, setExpandedVisitId] = useState<number | null>(null);
  // active section state
  const [activeSection, setActiveSection] = useState<string>('guide');
  
  const linkClass = (id: string) =>
    `px-2 py-2 text-sm md:text-[15px] font-medium ${
      activeSection === id
        ? 'text-slate-900 border-b-2 border-[#3B82F6]'
        : 'text-[#3B82F6] hover:text-[#1d4ed8] hover:underline'
    }`;

  useEffect(() => {
    const ids = [...(isComplete ? (['visits'] as const) : []), 'guide', 'faq', 'tips'];
    const io = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) setActiveSection((entry.target as HTMLElement).id);
        });
      },
      { rootMargin: '-40% 0px -50% 0px', threshold: [0, 0.25, 0.6] }
    );
    ids.forEach((id) => {
      const el = document.getElementById(id);
      if (el) io.observe(el);
    });
    return () => io.disconnect();
  }, [isComplete]);

  return (
    <div>
      {/* ================================= Hero (polished to match List) ================================= */}
      <header className="relative isolate grid min-h-[55vh] md:min-h-[65vh] place-items-center overflow-hidden">
        <div className="absolute inset-0 -z-10">
          <div className="absolute inset-0 bg-gradient-to-tr from-[#EC555C]/25 via-[#3B82F6]/20 to-transparent" />
          <div className="absolute inset-0 bg-black/40" />
        </div>
        <div className="mx-auto w-full max-w-7xl px-4 text-center">
          <div className="space-y-3">
            {/* Title + subtitle */}
            <h1 className="text-5xl md:text-7xl font-extrabold tracking-tight text-white drop-shadow">Fort McHenry</h1>
            <div className="mx-auto inline-flex items-center gap-2 rounded-full bg-[#EC555C] px-5 py-1.5 text-base font-extrabold text-white shadow md:text-lg">
              HOME OF THE NATIONAL ANTHEM
            </div>

            {/* CTA row — unified buttons */}
            <div className="blp-cta-row mt-4 flex flex-wrap items-center justify-center gap-2">
              <button
                onClick={() => { if (!isComplete) { setIsComplete(true); } else { setShowBeenOptions(true); } }}
                className={cx(ui.btnBase, isComplete ? ui.btnActive : ui.btnBrand, ui.solo)}
              >
                <BrandCheckIcon checked={isComplete} className="h-5 w-5 mr-1 inline"/> I’ve Been
              </button>
              <a href="#" className={cx(ui.btnBase, ui.btnBrand, ui.solo, 'inline-flex items-center justify-center')}><Navigation2 className="h-5 w-5 mr-1 inline"/> Go</a>
              <button onClick={()=>{setEditVisit(null); setShowSave(true);}} className={cx(ui.btnBase, ui.btnBrand, ui.solo)}><Heart className="h-5 w-5 mr-1 inline"/> Save to…</button>
            </div>
          </div>
        </div>
      </header>

      {/* ======================= Sub-nav (full-width bar above content) ======================= */}
      <div className="subnav-bar sticky top-0 z-30 bg-white border-b border-slate-200">
        <div className="mx-auto max-w-7xl px-4">
          <nav className="h-11 flex items-center gap-4">
            {isComplete && <a href="#visits" className={linkClass('visits')}>Visits</a>}
            <a href="#guide" className={linkClass('guide')}>Guide</a>
            <a href="#faq" className={linkClass('faq')}>FAQ</a>
            <a href="#tips" className={linkClass('tips')}>Tips</a>
          </nav>
        </div>
      </div>

      {/* ================================= Main grid: Left content + Right rail ================================= */}
      <main className="mx-auto grid max-w-7xl grid-cols-1 gap-6 px-4 pt-4 pb-6 md:grid-cols-12">
        {/* Left column */}
        <section className="md:col-span-8 lg:col-span-8">
          {/* Visits (first when complete) */}
          {isComplete && (
            <section id="visits" className="mt-4 scroll-mt-28 rounded-2xl border border-slate-200 bg-white p-6 shadow-sm">
              <div className="flex items-center justify-between">
                <p className="text-xs font-semibold text-slate-500 uppercase tracking-wide">Your Memories</p>
                <div className="flex items-center gap-2">
                  <button onClick={()=>{setEditVisit(null); setShowVisit(true);}} className={cx(ui.btnBase, ui.btnActive, ui.solo)} style={{height:'auto'}}>Add visit</button>
                  {visits.length > 0 && (
                    <button onClick={()=> setShowManageVisits(true)} className="text-sm font-medium text-[#3B82F6] hover:underline px-2 py-1 rounded">Manage</button>
                  )}
                </div>
              </div>
              {visits.length > 0 ? (
                <ul className="mt-4 divide-y divide-slate-200 rounded-xl bg-white ring-1 ring-slate-200">
                  {visits.map((v) => (
                    <li key={v.id} className="p-0">
                      <button
                        className="w-full text-left px-4 py-3 flex items-center justify-between gap-3 hover:bg-slate-50"
                        onClick={() => setExpandedVisitId(expandedVisitId === v.id ? null : v.id)}
                      >
                        <div className="min-w-0">
                          <p className="text-sm font-semibold truncate">{v.dateLabel}{v.note ? ' • ' + v.note : ''}</p>
                          <div className="mt-1 flex items-center gap-1">
                            {(v.photos?.slice(0,3) || []).map((p: any, i: number)=> (
                              <img key={i} src={p.src} alt="" className="h-6 w-8 rounded-md object-cover"/>
                            ))}
                            {(!v.photos || v.photos.length===0) && [0,1,2].map((i)=> (
                              <span key={i} className="h-6 w-8 rounded-md bg-slate-200"></span>
                            ))}
                          </div>
                        </div>
                        <div className="flex items-center gap-2">
                          <button onClick={(e)=>{ e.stopPropagation(); setEditVisit(v); setShowVisit(true); }} className="h-8 w-8 inline-flex items-center justify-center rounded-lg hover:bg-slate-100" title="Edit">
                            <Pencil className="h-4 w-4"/>
                          </button>
                          <button onClick={(e)=>{ e.stopPropagation(); setVisits(prev=>prev.filter(x=>x.id!==v.id)); }} className="h-8 w-8 inline-flex items-center justify-center rounded-lg hover:bg-slate-100" title="Delete">
                            <Trash2 className="h-4 w-4"/>
                          </button>
                        </div>
                      </button>
                      {expandedVisitId === v.id && (
                        <div className="px-4 pb-4">
                          <div className="mt-2 grid grid-cols-3 gap-2">
                            {(v.photos || []).slice(0,6).map((p: any, idx: number)=> (
                              <div key={idx} className="space-y-1">
                                <img src={p.src} alt="" className="aspect-[4/3] w-full rounded-lg object-cover bg-slate-200"/>
                                {p.caption && <p className="text-xs text-slate-600">{p.caption}</p>}
                              </div>
                            ))}
                            {(!v.photos || v.photos.length===0) && [0,1,2,3,4,5].map((i)=> (
                              <div key={i} className="aspect-[4/3] rounded-lg bg-slate-200"></div>
                            ))}
                          </div>
                          {v.note && <p className="mt-3 text-sm text-slate-700">{v.note}</p>}
                        </div>
                      )}
                    </li>
                  ))}
                </ul>
              ) : (
                <div className="mt-3 rounded-xl border border-dashed border-slate-300 p-3 text-sm text-slate-600">No visits yet — add a quick note or photo to start your memories. It takes 10 seconds and helps other travelers.</div>
              )}
            </section>
          )}

          {/* Guide */}
          <section id="guide" className="mt-4 scroll-mt-28 rounded-2xl border border-slate-200 bg-white p-6 shadow-sm">
            <p className="text-xs font-semibold text-slate-500 uppercase tracking-wide">Overview</p>
            <div className={!guideExpanded ? 'max-h-32 overflow-hidden relative' : ''}>
              {!guideExpanded && <div className="absolute left-0 right-0 bottom-0 h-16 bg-gradient-to-b from-transparent to-white"/>}
              <p className="mt-2 text-sm text-slate-800">Where the Star-Spangled Banner was born: a compact fort with sweeping harbor views and living history. It’s an easy win—flat paths, open lawns, and a visitor film that sets the scene in under 15 minutes.</p>
              <p className="mt-2 text-sm text-slate-800">Start at the visitor center for your map, then follow the ramp to the east wall for the best harbor vantage. Time your visit for a flag raising or lowering—the ranger talk turns the place into a story you’ll remember.</p>
              <p className="mt-2 text-sm text-slate-800">For a slower visit, circle the star-shaped ramparts clockwise and watch ships move in and out of the Patapsco.</p>
            </div>
            {!guideExpanded && (
              <div className="mt-2">
                <button onClick={()=>setGuideExpanded(true)} className="inline-flex items-center gap-1 text-sm font-medium text-slate-600 hover:text-slate-800 underline underline-offset-2 decoration-slate-300 hover:decoration-slate-400">Read more <ChevronRight className="h-4 w-4"/></button>
              </div>
            )}
            {guideExpanded && (
              <div className="mt-4">
                <div className="mb-3 text-sm">
                  <strong>In this guide</strong>
                  <ul className="list-disc pl-5 mt-1 space-y-1">
                    <li>History & context</li>
                    <li>What to see</li>
                    <li>Getting there & parking</li>
                    <li>Accessibility</li>
                  </ul>
                </div>
                <p className="text-sm text-slate-800">Long-form guide content would live here. For this demo, the TOC shows how sections would be organized once expanded.</p>
                <div className="mt-3 text-right">
                  <button onClick={()=>setGuideExpanded(false)} className="inline-flex items-center gap-1 text-sm font-medium text-slate-600 hover:text-slate-800 underline underline-offset-2 decoration-slate-300 hover:decoration-slate-400">Collapse guide</button>
                </div>
              </div>
            )}
          </section>

          {/* FAQ */}
          <section id="faq" className="mt-4 scroll-mt-28 rounded-2xl border border-slate-200 bg-white p-6 shadow-sm">
            <p className="text-xs font-semibold text-slate-500 uppercase tracking-wide">Popular Q&amp;A</p>

            <details className="mt-3 border-t border-slate-200 pt-3">
              <summary className="cursor-pointer font-semibold">What’s new? <span className="ml-2 inline-flex items-center rounded-full bg-slate-900 text-white text-[11px] px-2 py-[1px]">Updated today</span></summary>
              <ul className="mt-2 list-disc pl-5 space-y-1 text-sm">
                <li>Sunset flag lowering 6:30pm (Fri–Sun)</li>
                <li>Temporary exhibit: War of 1812</li>
                <li>Harbor shuttle every 20 minutes</li>
              </ul>
            </details>

            <details className="mt-3 border-t border-slate-200 pt-3">
              <summary className="cursor-pointer font-semibold">What are the hours? <span className="text-slate-500 font-normal">— 9:00–17:00 (daily)</span></summary>
              <p className="mt-2 text-sm">Hours may vary for holidays and special events; check the official site before you go.</p>
            </details>

            <details className="mt-3 border-t border-slate-200 pt-3">
              <summary className="cursor-pointer font-semibold">How much does it cost? <span className="text-slate-500 font-normal">— $15 adults · kids free</span></summary>
              <p className="mt-2 text-sm">Admission covers the fort and visitor center exhibits; special tours may be extra.</p>
            </details>

            <details className="mt-3 border-t border-slate-200 pt-3">
              <summary className="cursor-pointer font-semibold">Where do I park? <span className="text-slate-500 font-normal">— On-site lot + overflow</span></summary>
              <p className="mt-2 text-sm">Lots can fill on weekends by mid-day; arrive early or consider rideshare.</p>
            </details>

            <details className="mt-3 border-t border-slate-200 pt-3">
              <summary className="cursor-pointer font-semibold">Is it accessible? <span className="text-slate-500 font-normal">— Flat paths; accessible restrooms</span></summary>
              <p className="mt-2 text-sm">Most ramparts have graded access; some historic areas may have uneven surfaces.</p>
            </details>

            {/* Ask a question at the bottom */}
            <div className="mt-4">
              <div className="flex items-center rounded-xl border border-slate-300 px-3 py-2 text-sm">
                <span className="text-slate-400 mr-2"><HelpCircle className="h-4 w-4"/></span>
                <input className="flex-1 outline-none bg-transparent" placeholder="Ask a question…" />
                <button className={cx(ui.btnBase, ui.btnActive, ui.solo)} style={{height:'auto'}}>Ask</button>
              </div>
            </div>
          </section>

          {/* Tips */}
          <section id="tips" className="mt-4 scroll-mt-28 rounded-2xl border border-slate-200 bg-white p-6 shadow-sm">
            <p className="text-xs font-semibold text-slate-500 uppercase tracking-wide">Travel Tips</p>
            <ul className="mt-3 list-disc pl-5 space-y-1 text-sm">
              <li>Arrive 30 min before sunset for the lowering ceremony and best light.</li>
              <li>Wind picks up on the ramparts—bring a light jacket even in summer.</li>
              <li>Stroller route: enter via visitor center, ramp to east wall loop.</li>
            </ul>
          </section>
        </section>

        {/* Right rail */}
        <aside className="md:col-span-4 lg:col-span-4">
          <div className="right-rail sticky top-4 space-y-4">
            {/* Explore More */}
            <div data-test="type-tags" className="rounded-2xl border border-slate-200 bg-white p-4 shadow-sm">
              <div className="text-xs font-semibold uppercase tracking-wide text-slate-500">Explore More</div>
              <div className="mt-2 flex flex-wrap gap-1.5 text-xs">
                <span className="rounded-full border border-slate-200 px-2 py-0.5">Historic Fort</span>
                <span className="rounded-full border border-slate-200 px-2 py-0.5">history</span>
                <span className="rounded-full border border-slate-200 px-2 py-0.5">harbor views</span>
                <span className="rounded-full border border-slate-200 px-2 py-0.5">family-friendly</span>
              </div>
            </div>

            {/* Map & Location */}
            <div data-test="location" className="rounded-2xl border border-slate-200 bg-white p-4 shadow-sm">
              <div className="text-xs font-semibold uppercase tracking-wide text-slate-500">Location</div>
              <div className="mt-3 h-40 w-full rounded-xl bg-slate-100" />
              <div className="mt-2 text-sm text-slate-700"><span className="font-semibold">USA</span> <span className="text-slate-400">›</span> Maryland <span className="text-slate-400">›</span> Baltimore</div>
              <a href="#" className="mt-2 inline-flex items-center text-sm font-semibold text-[#3B82F6] hover:underline">View on Google Maps</a>
            </div>

            {/* Store promos (mirrors List style) */}
            <div className="store-promos space-y-4">
              <div className="rounded-2xl border border-rose-200 bg-white p-4 shadow-sm">
                <div className="mb-2 font-semibold">Personalized Poster</div>
                <div className="h-40 w-full rounded-xl bg-slate-100 mb-3" />
                <ul className="mb-3 list-inside list-disc text-sm text-slate-700">
                  <li>Add your name or dedication</li>
                  <li>Optional frame</li>
                  <li>Ships fast</li>
                </ul>
                <button className="w-full rounded-lg bg-[#EC555C] py-2 text-sm font-semibold text-white hover:opacity-90">Preview my poster</button>
              </div>

              <div className="rounded-2xl border border-purple-200 bg-white p-4 shadow-sm">
                <div className="mb-2 font-semibold">The Gift Bundle <span className="ml-2 rounded bg-purple-50 px-2 py-0.5 text-xs text-purple-700">Most popular</span></div>
                <ul className="mb-3 list-inside list-disc text-sm text-slate-700">
                  <li>Poster + Pocket Book</li>
                  <li>Gift note card included</li>
                  <li>Personalize recipient name</li>
                  <li>Ready-to-gift sleeve</li>
                </ul>
                <div className="mb-2 text-xs text-slate-600">Great for birthdays • housewarmings • graduations</div>
                <button className="w-full rounded-lg bg-purple-600 py-2 text-sm font-semibold text-white hover:bg-purple-700">Get the bundle</button>
              </div>

              <div className="rounded-2xl border border-amber-200 bg-white p-4 shadow-sm">
                <div className="mb-2 font-semibold">Limited‑Edition Fort Print</div>
                <div className="text-sm text-slate-700">Numbered run, archival inks, optional frame. 30‑day returns.</div>
                <button className="mt-3 w-full rounded-lg bg-amber-600 py-2 text-sm font-semibold text-white hover:bg-amber-700">See sizes & frames</button>
              </div>
            </div>
          </div>
        </aside>
      </main>

      {/* ============================== Modals ============================== */}
      {showVisit && (
        <VisitModal
          initial={editVisit}
          onSave={(data)=>{
            if (editVisit && editVisit.id) {
              setVisits(prev=>prev.map(v=> v.id===editVisit.id ? {...editVisit, ...data} : v));
            } else {
              const id = data?.id || Date.now();
              setVisits(prev=>[{ id, ...data }, ...prev]);
            }
            setIsComplete(true);
            setEditVisit(null);
            setShowVisit(false);
          }}
          onClose={()=>{ setEditVisit(null); setShowVisit(false); }}
        />
      )}
      {showSave && <SaveModal onClose={()=>setShowSave(false)} />}
      {showBeenOptions && (
        <BeenOptionsModal
          onAddAnother={() => { setShowBeenOptions(false); setEditVisit(null); setShowVisit(true); }}
          onManage={() => { setShowBeenOptions(false); setShowManageVisits(true); }}
          onUncheck={() => { setShowBeenOptions(false); setIsComplete(false); }}
          onClose={() => setShowBeenOptions(false)}
        />
      )}
      {showManageVisits && (
        <ManageVisitsModal
          visits={visits}
          onEdit={(v)=>{ setEditVisit(v); setShowManageVisits(false); setShowVisit(true); }}
          onDelete={(id)=>{ setVisits(prev=>prev.filter(x=>x.id!==id)); }}
          onClose={()=> setShowManageVisits(false)}
        />
      )}

      <footer className="pb-20 md:pb-8" />
    </div>
  );
}

function VisitModal({ onClose, onSave, initial }:{ onClose: ()=>void; onSave: (p:any)=>void; initial: any }){
  const [dateChoice, setDateChoice] = useState(initial?.dateChoice || 'Today');
  const [timeChoice, setTimeChoice] = useState(initial?.timeChoice || '60');
  const [note, setNote] = useState(initial?.note || '');
  const [photos, setPhotos] = useState<any[]>(initial?.photos || []);
  const dateOptions = ['Today','This week','Pick date'];
  const timeOptions = ['15','30','60','90','120+'];

  function onFilesSelected(e:any){
    const files = Array.from(e.target.files || []).slice(0,6);
    Promise.all(files.map((f:any)=> new Promise((res,rej)=>{ const fr=new FileReader(); fr.onload=()=>res({src:fr.result as string, caption:''}); fr.onerror=rej; fr.readAsDataURL(f);})))
      .then((items:any)=> setPhotos(items))
      .catch(()=>{});
  }
  function updateCaption(i:number, val:string){ setPhotos(prev=> prev.map((p,idx)=> idx===i? {...p, caption:val} : p)); }

  return (
    <div className="fixed inset-0 z-[100]">
      <div className="absolute inset-0 bg-black/40" onClick={onClose}></div>
      <div className="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-lg rounded-2xl bg-white shadow-2xl ring-1 ring-black/10">
        <div className="flex items-center justify-between p-4 border-b border-slate-200">
          <p className="text-sm font-semibold">{initial && initial.id ? 'Edit visit' : 'Add visit'}</p>
          <button onClick={onClose} className="h-8 w-8 inline-flex items-center justify-center rounded-lg hover:bg-slate-100"><X className="h-4 w-4"/></button>
        </div>
        <div className="p-4 grid gap-3 text-sm">
          <div>
            <p className="text-xs text-slate-500">When did you go?</p>
            <div className="mt-1 grid grid-cols-3 gap-2">
              {dateOptions.map((x)=> (
                <button key={x} onClick={()=>setDateChoice(x)} className={`rounded-xl border px-3 py-2 ${dateChoice===x? 'border-slate-900' : 'border-slate-300'}`}>{x}</button>
              ))}
            </div>
          </div>
          <div>
            <p className="text-xs text-slate-500">Time spent</p>
            <div className="mt-1 grid grid-cols-5 gap-2">
              {timeOptions.map((x)=> (
                <button key={x} onClick={()=>setTimeChoice(x)} className={`rounded-xl border px-3 py-2 ${timeChoice===x? 'border-slate-900' : 'border-slate-300'}`}>{x}m</button>
              ))}
            </div>
          </div>
          <div>
            <p className="text-xs text-slate-500">Notes</p>
            <textarea value={note} onChange={(e)=>setNote(e.target.value)} className="w-full rounded-xl border border-slate-300 p-2" rows={3} maxLength={140} placeholder="140 characters…"/>
          </div>

          <div>
            <p className="text-xs text-slate-500">Photos & captions (optional)</p>
            <input type="file" accept="image/*" multiple onChange={onFilesSelected} className="mt-1"/>
            {photos.length > 0 && (
              <div className="mt-2 grid grid-cols-3 gap-2">
                {photos.map((p, idx)=> (
                  <div key={idx} className="space-y-1">
                    <img src={p.src} alt="" className="aspect-[4/3] w-full rounded-xl object-cover bg-slate-100 ring-1 ring-slate-200"/>
                    <input value={(p as any).caption} onChange={(e)=>updateCaption(idx, (e.target as HTMLInputElement).value)} className="w-full rounded-lg border border-slate-300 p-1 text-xs" placeholder="Caption (optional)"/>
                  </div>
                ))}
              </div>
            )}
          </div>

          <div className="grid grid-cols-2 gap-2 mt-1">
            <button
              className="rounded-xl bg-slate-900 text-white px-3 py-2 text-sm font-semibold"
              onClick={() => {
                const payload = {
                  id: initial?.id || Date.now(),
                  dateLabel: dateChoice,
                  dateChoice,
                  timeSpent: timeChoice,
                  timeChoice,
                  note: note.trim(),
                  photos
                };
                onSave && onSave(payload);
              }}
            >{initial && initial.id ? 'Save changes' : 'Save visit'}</button>
            <button className="rounded-xl border border-slate-300 px-3 py-2 text-sm font-medium" onClick={onClose}>Cancel</button>
          </div>
        </div>
      </div>
    </div>
  );
}

function SaveModal({ onClose }:{ onClose: ()=>void }){
  return (
    <div className="fixed inset-0 z-[100]">
      <div className="absolute inset-0 bg-black/40" onClick={onClose}></div>
      <div className="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-md rounded-2xl bg-white shadow-2xl ring-1 ring-black/10">
        <div className="flex items-center justify-between p-4 border-b border-slate-200">
          <p className="text-sm font-semibold">Save to…</p>
          <button onClick={onClose} className="h-8 w-8 inline-flex items-center justify-center rounded-lg hover:bg-slate-100"><X className="h-4 w-4"/></button>
        </div>
        <div className="p-4 grid gap-2">
          <button className="flex items-center justify-between rounded-xl border border-slate-200 px-3 py-3 text-sm"><span>Bucket List (default)</span><BookmarkCheck className="h-5 w-5"/></button>
          <button className="flex items-center justify-between rounded-xl border border-slate-200 px-3 py-3 text-sm"><span>Baltimore Weekend</span></button>
          <button className="flex items-center justify-between rounded-xl border border-slate-200 px-3 py-3 text-sm"><span>Stadium Tour</span></button>
          <button className="flex items-center justify-center gap-2 rounded-xl bg-slate-100 px-3 py-3 text-sm font-medium"><Plus className="h-4 w-4"/> Create new list</button>
          <div className="grid grid-cols-2 gap-2 mt-1">
            <button className="rounded-xl bg-slate-900 text-white px-3 py-2 text-sm font-semibold" onClick={onClose}>Done</button>
            <button className="rounded-xl border border-slate-300 px-3 py-2 text-sm font-medium" onClick={onClose}>Cancel</button>
          </div>
        </div>
      </div>
    </div>
  );
}

function BeenOptionsModal({ onAddAnother, onManage, onUncheck, onClose }:{ onAddAnother: ()=>void; onManage: ()=>void; onUncheck: ()=>void; onClose: ()=>void; }){
  return (
    <div className="fixed inset-0 z-[110]">
      <div className="absolute inset-0 bg-black/40" onClick={onClose}></div>
      <div className="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-sm rounded-2xl bg-white shadow-2xl ring-1 ring-black/10 p-4">
        <p className="text-sm font-semibold mb-3">What would you like to do?</p>
        <div className="grid gap-2 text-sm">
          <button onClick={onAddAnother} className="rounded-xl border border-slate-300 px-3 py-2 text-left">Add another visit</button>
          <button onClick={onManage} className="rounded-xl border border-slate-300 px-3 py-2 text-left">Manage visits</button>
          <button onClick={onUncheck} className="rounded-xl border border-slate-300 px-3 py-2 text-left">Remove checkmark</button>
          <button onClick={onClose} className="rounded-xl bg-slate-900 text-white px-3 py-2 font-semibold">Cancel</button>
        </div>
      </div>
    </div>
  );
}

function ManageVisitsModal({ visits, onEdit, onDelete, onClose }:{ visits:any[]; onEdit:(v:any)=>void; onDelete:(id:number)=>void; onClose: ()=>void; }){
  return (
    <div className="fixed inset-0 z-[120]">
      <div className="absolute inset-0 bg-black/40" onClick={onClose}></div>
      <div className="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-lg rounded-2xl bg-white shadow-2xl ring-1 ring-black/10">
        <div className="flex items-center justify-between p-4 border-b border-slate-200">
          <p className="text-sm font-semibold">Manage visits</p>
          <button onClick={onClose} className="h-8 w-8 inline-flex items-center justify-center rounded-lg hover:bg-slate-100"><X className="h-4 w-4"/></button>
        </div>
        <div className="p-4 grid gap-2">
          {visits.length === 0 ? (
            <p className="text-sm text-slate-600">No visits yet.</p>
          ) : (
            visits.map((v)=> (
              <div key={v.id} className="flex items-center justify-between rounded-xl border border-slate-200 px-3 py-2 text-sm">
                <div>
                  <p className="font-semibold">{v.dateLabel}</p>
                  {v.note && <p className="text-slate-700">{v.note}</p>}
                </div>
                <div className="flex items-center gap-2">
                  <button onClick={()=>onEdit(v)} className="h-8 w-8 inline-flex items-center justify-center rounded-lg hover:bg-slate-100" title="Edit"><Pencil className="h-4 w-4"/></button>
                  <button onClick={()=>onDelete(v.id)} className="h-8 w-8 inline-flex items-center justify-center rounded-lg hover:bg-slate-100" title="Delete"><Trash2 className="h-4 w-4"/></button>
                </div>
              </div>
            ))
          )}
          <div className="mt-2 text-right">
            <button onClick={onClose} className="rounded-xl bg-slate-900 text-white px-3 py-2 text-sm font-semibold">Done</button>
          </div>
        </div>
      </div>
    </div>
  );
}


window.BucketlistedItemPolished = BucketlistedItemPolished;


// ==== self_guided_tour_mockup.jsx ====


// ==============================
// Mock tour data for Fell's Point, Maryland
// ==============================
const STOPS = [
  {
    id: 1,
    title: "Broadway Square",
    excerpt: "Historic market square at the heart of Fell's Point.",
    details:
      "Broadway Square has been a public gathering space since the 18th century. Stand in the center and notice how the streets radiate outward — a clue to the neighborhood’s maritime past.",
    photo: "https://placehold.co/800x800",
    audio: "audio1.mp3",
  },
  {
    id: 2,
    title: "Thames Street Waterfront",
    excerpt: "Cobblestone streets along the harbor with historic taverns.",
    details:
      "Walk the length of Thames Street to feel the old port’s rhythm — ships once queued here, and the taverns tell the story of sailors who never quite left.",
    photo: "https://placehold.co/800x800",
    audio: "audio2.mp3",
  },
  {
    id: 3,
    title: "The Horse You Came In On Saloon",
    excerpt: "America’s oldest continually operating saloon, linked to Edgar Allan Poe.",
    details:
      "Step under the swinging doors and imagine Poe slipping into the corner. The creak of the wood and the patina on the bar are as much the exhibit as any plaque.",
    photo: "https://placehold.co/800x800",
    audio: "audio3.mp3",
  },
  {
    id: 4,
    title: "Frederick Douglass–Isaac Myers Maritime Park",
    excerpt: "Museum honoring African American maritime heritage.",
    details:
      "This waterfront site celebrates the first African American–owned shipyard in the U.S. Pause at the rail for one last look across the working harbor.",
    photo: "",
    audio: "audio4.mp3",
  },
];

// ==============================
// Helpers
// ==============================
const cx = (...parts) => parts.filter(Boolean).join(" ");

// Simple confetti burst overlay (no external libs)
function ConfettiBurst() {
  const colors = ["#EC555C", "#3B82F6", "#FFD166", "#06D6A0", "#8338EC", "#FF9F1C"]; // coral, blue + accents
  const pieces = Array.from({ length: 80 });
  return (
    <div className="pointer-events-none fixed inset-0 z-[80] overflow-hidden">
      <style>{`
        @keyframes confetti-fall {0%{transform: translateY(-10vh) rotate(0);}100%{transform: translateY(110vh) rotate(720deg);}}
      `}</style>
      {pieces.map((_, i) => {
        const left = Math.random() * 100;
        const delay = Math.random() * 0.4;
        const duration = 1 + Math.random() * 1.6;
        const sizeW = 6 + Math.random() * 6;
        const sizeH = 8 + Math.random() * 10;
        const bg = colors[i % colors.length];
        return (
          <span
            key={i}
            style={{
              position: "absolute",
              left: `${left}%`,
              top: `-10vh`,
              width: `${sizeW}px`,
              height: `${sizeH}px`,
              backgroundColor: bg,
              opacity: 0.9,
              borderRadius: 2,
              animation: `confetti-fall ${duration}s ease-out ${delay}s forwards`,
            }}
          />
        );
      })}
    </div>
  );
}

// ==============================
// Dev smoke tests (runtime)
// ==============================
function runSmokeTests() {
  try {
    console.assert(Array.isArray(STOPS) && STOPS.length > 0, "STOPS should be a non-empty array");
    console.assert(typeof STOPS[0].title === "string", "Stop has a title");
    setTimeout(() => {
      console.assert(!!document.querySelector("header"), "Header renders");
      console.assert(!!document.querySelector("#stops"), "Stops section renders");
      console.assert(!!document.querySelector("#map"), "Map section renders");
      console.assert(!!document.querySelector('button[data-live-start]'), 'Start Live Tour button present');
      const expandedBtns = Array.from(document.querySelectorAll('button[data-expander][aria-expanded="true"]'));
      console.assert(expandedBtns.length <= 1, 'Only one card should be expanded at a time');
      // New tests: sticky mobile bar exists & map indentation class is present
      console.assert(!!document.querySelector('#mobile-sticky'), 'Mobile sticky footer present');
      const map = document.querySelector('#map');
      console.assert(map && map.className.includes('ml-12'), 'Map is indented (ml-12)');
    }, 0);
  } catch {}
}

// ==============================
// Main component
// ==============================
function SelfGuidedTour() {
  const [checked, setChecked] = useState([]);
  const [expanded, setExpanded] = useState([]); // keep as array for compatibility; enforce single-open
  const [current, setCurrent] = useState(0);
  const [playing, setPlaying] = useState(false);
  const [liveOverlay, setLiveOverlay] = useState(false);
  const [showConfetti, setShowConfetti] = useState(false);

  useEffect(() => {
    runSmokeTests();
  }, []);

  const firstTodoIdx = (checkedList = checked) => STOPS.findIndex((s) => !checkedList.includes(s.id));

  // Expand a card, auto-complete all previous, and ensure only one open
  const expandOne = (id) => {
    const idx = STOPS.findIndex((s) => s.id === id);
    if (idx === -1) return;
    // auto-check all previous
    setChecked((prev) => {
      const prevIds = STOPS.slice(0, idx).map((s) => s.id);
      const merged = Array.from(new Set([...prev, ...prevIds]));
      return merged;
    });
    setExpanded([id]);
    setCurrent(idx);
    // scroll into view
    const el = document.getElementById(`stop-${id}`);
    if (el) el.scrollIntoView({ behavior: "smooth", block: "start" });
  };

  const toggleCheck = (id) =>
    setChecked((prev) => (prev.includes(id) ? prev.filter((x) => x !== id) : [...prev, id]));

  const toggleExpand = (id) => {
    const isOpen = expanded.includes(id);
    if (isOpen) {
      setExpanded([]);
    } else {
      expandOne(id);
    }
  };

  const count = checked.length;
  const max = STOPS.length;
  const allDone = count === max && max > 0;

  // Kick confetti when tour completes
  useEffect(() => {
    if (allDone) {
      setShowConfetti(true);
      const t = setTimeout(() => setShowConfetti(false), 2200);
      return () => clearTimeout(t);
    }
  }, [allDone]);

  const goPrev = () => {
    const openId = expanded[0];
    if (!openId) return;
    const idx = STOPS.findIndex((s) => s.id === openId);
    if (idx > 0) expandOne(STOPS[idx - 1].id);
  };

  const goNext = () => {
    // If something is open, mark it done before advancing
    const openId = expanded[0];
    let nextChecked = checked;
    if (openId && !checked.includes(openId)) {
      nextChecked = [...checked, openId];
      setChecked(nextChecked);
    }
    const idx = firstTodoIdx(nextChecked);
    if (idx === -1) {
      setExpanded([]);
      return;
    }
    expandOne(STOPS[idx].id);
  };

  const restartTour = () => {
    setChecked([]);
    setExpanded([]);
    setCurrent(0);
    window.scrollTo({ top: 0, behavior: 'smooth' });
  };

  const startLive = () => {
    const idx = firstTodoIdx();
    setCurrent(idx === -1 ? 0 : idx);
    setLiveOverlay(true);
  };

  const nextInLive = () => {
    // Auto-mark current as done when advancing
    const stop = STOPS[current];
    if (stop && !checked.includes(stop.id)) setChecked((prev) => [...prev, stop.id]);
    const idx = firstTodoIdx();
    if (idx === -1) {
      setLiveOverlay(false);
      return;
    }
    setCurrent(idx);
  };

  const backInLive = () => {
    const prevIdx = Math.max(0, current - 1);
    setCurrent(prevIdx);
  };

  const skipInLive = () => {
    const idx = firstTodoIdx();
    if (idx === -1) {
      setLiveOverlay(false);
      return;
    }
    // do not mark done; just move to next unchecked
    setCurrent(idx);
  };

  return (
    <div className="min-h-screen bg-neutral-50 text-neutral-900">
      {/* Confetti overlay */}
      {showConfetti && <ConfettiBurst />}

      {/* Hero */}
      <header className="relative isolate grid min-h-[40vh] place-items-center overflow-hidden bg-gradient-to-tr from-[#EC555C]/40 via-[#3B82F6]/30 to-transparent">
        <div className="absolute inset-0 bg-black/40" />
        <div className="relative z-10 text-center space-y-4 px-4">
          <h1 className="text-4xl md:text-6xl font-extrabold text-white drop-shadow-sm">Fell's Point Walking Tour</h1>
          {/* Coral pill re-used as subtitle (consistent with other pages) */}
          <div className="inline-flex items-center gap-2 rounded-full bg-[#EC555C] px-5 py-1.5 text-sm font-extrabold text-white shadow">
            Self‑Guided Tour
          </div>
          <div className="flex flex-wrap items-center justify-center gap-2">
            <button
              data-live-start
              onClick={() => { if (allDone) { restartTour(); } startLive(); }}
              className="rounded-full bg-white/95 text-[#3B82F6] px-5 py-2 font-bold shadow hover:bg-white"
            >
              {allDone ? 'Restart Live Tour' : 'Start Live Tour'}
            </button>
            <button className="rounded-full bg-white/95 text-[#3B82F6] px-5 py-2 font-bold shadow hover:bg-white">Save</button>
            <button className="rounded-full bg-white/95 text-[#3B82F6] px-5 py-2 font-bold shadow hover:bg-white">Share</button>
          </div>
        </div>
      </header>

      {/* Main layout: Stops (primary) + Right Rail (Progress/Congrats) */}
      <main className="mx-auto max-w-6xl grid grid-cols-1 md:grid-cols-12 gap-6 px-4 py-6">
        {/* Stops list with dotted tour style */}
        <section id="stops" className="md:col-span-8 relative space-y-6">
          <div className="absolute left-5 top-0 bottom-0 border-l-4 border-dotted border-[#3B82F6]" aria-hidden="true"></div>
          <ol className="space-y-6 relative">
            {STOPS.map((stop, idx) => {
              const isChecked = checked.includes(stop.id);
              const isOpen = expanded.includes(stop.id);
              const isCurrent = idx === current;
              const panelId = `panel-${stop.id}`;
              const thumb = stop.photo || "https://placehold.co/200x200?text=No+Photo";
              return (
                <li id={`stop-${stop.id}`} key={stop.id} className="relative ml-12">
                  {/* Pin icon */}
                  <div className="absolute -left-9 top-2 flex items-center justify-center h-8 w-8 rounded-full bg-[#3B82F6] text-white ring-4 ring-white shadow">
                    {idx + 1}
                  </div>

                  <div
                    className={cx(
                      "rounded-2xl border bg-white p-4 shadow-sm transition",
                      isCurrent && "ring-2 ring-[#3B82F6]",
                      isChecked ? "opacity-95" : ""
                    )}
                  >
                    {/* Row: thumbnail (left) → text (center) → actions (right) */}
                    <div className="flex items-start gap-3">
                      {/* Checkbox */}
                      <label className="flex h-8 w-8 shrink-0 items-center justify-center rounded-full hover:bg-neutral-50 cursor-pointer mt-4">
                        <input
                          type="checkbox"
                          checked={isChecked}
                          onChange={() => toggleCheck(stop.id)}
                          className="h-5 w-5 text-[#EC555C] focus:ring-[#EC555C] rounded"
                        />
                      </label>

                      {/* Thumbnail on the LEFT (hidden when expanded) */}
                      {!isOpen && (
                        <img src={thumb} alt="" className="h-16 w-16 rounded-md object-cover shrink-0" />
                      )}

                      {/* Main text */}
                      <button
                        data-expander
                        aria-controls={panelId}
                        aria-expanded={isOpen}
                        onClick={() => toggleExpand(stop.id)}
                        className="flex-1 text-left"
                      >
                        <h3 className={cx("font-bold text-lg", isChecked && "line-through")}>{stop.title}</h3>
                        <p className="text-sm text-neutral-600 mt-1 line-clamp-1">{stop.excerpt}</p>
                      </button>

                      {/* Actions: Play then Chevron on the RIGHT */}
                      <div className="shrink-0 flex items-center gap-2">
                        <button
                          onClick={() => {
                            setCurrent(idx);
                            setPlaying((p) => (isCurrent ? !p : true));
                          }}
                          className="rounded-md bg-[#EC555C] text-white px-3 py-1 text-xs font-semibold inline-flex items-center gap-1"
                          aria-label={playing && isCurrent ? "Pause audio" : "Play audio"}
                        >
                          {playing && isCurrent ? <Pause className="h-3 w-3" /> : <Play className="h-3 w-3" />}
                          <span>{playing && isCurrent ? "Pause" : "Play"}</span>
                        </button>
                        <button
                          onClick={() => toggleExpand(stop.id)}
                          aria-controls={panelId}
                          aria-expanded={isOpen}
                          className="grid place-items-center h-8 w-8 rounded-full border bg-white shadow"
                          title={isOpen ? "Collapse" : "Expand"}
                        >
                          <ChevronRight className={cx("h-4 w-4 transition-transform", isOpen && "rotate-90")} />
                        </button>
                      </div>
                    </div>

                    {/* Expanded content — inline, full width, on base card background */}
                    {isOpen && (
                      <div id={panelId} className="mt-4 space-y-3 text-sm text-neutral-800">
                        {/* Full-width photo (optional) */}
                        {stop.photo && (
                          <img data-stop-img src={stop.photo} alt="" className="rounded-xl w-full h-64 object-cover" />
                        )}

                        {/* Single details block (editor-controlled) */}
                        <p>{stop.details || stop.excerpt}</p>

                        {/* Control bar: Go Back (left), Add Photo/Note (center), Next/Finish (right) */}
                        <div className="flex items-center justify-between pt-2">
                          <button onClick={goPrev} className="rounded-lg border px-3 py-2 font-semibold inline-flex items-center gap-2 text-neutral-700">
                            <ArrowLeft className="h-4 w-4" /> Go back
                          </button>

                          <button className="inline-flex items-center gap-2 rounded-md border px-3 py-2 text-[#3B82F6] font-semibold">
                            <Camera className="h-4 w-4" /> Add a photo or note
                          </button>

                          {(() => {
                            const remaining = STOPS.filter(s => !checked.includes(s.id));
                            const isLast = remaining.length === 1 && remaining[0].id === stop.id;
                            return (
                              <button onClick={goNext} className="rounded-lg bg-[#3B82F6] text-white px-4 py-2 font-semibold inline-flex items-center gap-2">
                                {isLast ? 'Finish' : 'Next stop'} <ChevronRight className="h-4 w-4" />
                              </button>
                            );
                          })()}
                        </div>
                      </div>
                    )}
                  </div>
                </li>
              );
            })}
          </ol>

          {/* Map sits BELOW stops to keep the primary flow clean; indented so it doesn't clash with dotted spine */}
          <section id="map" className="mt-8 ml-12 rounded-2xl border border-neutral-200 bg-white p-4 shadow-sm">
            <div className="font-semibold mb-2 flex items-center gap-2">
              <MapPin className="h-5 w-5 text-[#EC555C]" /> Map
            </div>
            <div className="h-72 bg-neutral-100 rounded-xl" />
            <p className="mt-2 text-xs text-neutral-500">Interactive map loads in production.</p>
          </section>
        </section>

        {/* Right rail: Progress card or Congrats (sticky on desktop) */}
        <aside className="md:col-span-4 space-y-4 md:sticky md:top-6 self-start">
          {!allDone ? (
            <div className="rounded-2xl border-2 border-[#EC555C] bg-white p-6 shadow-md text-center">
              <div className="text-xl font-black text-[#3B82F6] mb-2">Tour Progress</div>
              <div className="text-3xl font-extrabold text-[#EC555C]">{count}/{max}</div>
              <div className="text-sm text-neutral-700 mt-1">Stops completed</div>
            </div>
          ) : (
            <div className="rounded-2xl p-6 shadow-md text-center bg-gradient-to-br from-[#3B82F6] to-[#EC555C] text-white">
              <div className="flex items-center justify-center mb-2">
                <CheckCircle2 className="h-6 w-6" />
              </div>
              <div className="text-2xl font-extrabold">Congrats — Tour Complete!</div>
              <div className="mt-2 text-sm opacity-90">You visited all {max} stops in Fell's Point.</div>
              <div className="mt-4 flex items-center justify-center gap-2">
                <button onClick={restartTour} className="rounded-full bg-white/95 text-[#3B82F6] px-4 py-2 font-bold shadow hover:bg-white">Restart tour</button>
                <button className="rounded-full border border-white/70 px-4 py-2 font-semibold">Share</button>
              </div>
            </div>
          )}
        </aside>
      </main>

      {/* Mobile sticky progress anchor */}
      <div id="mobile-sticky" className="md:hidden fixed inset-x-0 bottom-0 z-40 border-t border-neutral-200 bg-white/95 backdrop-blur">
        {!allDone ? (
          <div className="mx-auto max-w-6xl px-4 py-2 flex items-center justify-between gap-3 text-sm">
            <div className="font-semibold">Progress: {count}/{max}</div>
            <button onClick={goNext} className="rounded-full bg-[#3B82F6] text-white px-4 py-2 font-semibold">
              Next stop →
            </button>
          </div>
        ) : (
          <div className="mx-auto max-w-6xl px-4 py-2 flex items-center justify-between gap-3 text-sm">
            <div className="font-semibold">Tour complete 🎉</div>
            <div className="flex items-center gap-2">
              <button onClick={restartTour} className="rounded-full bg-[#3B82F6] text-white px-3 py-2 font-semibold">Restart</button>
              <button className="rounded-full border px-3 py-2 font-semibold">Share</button>
            </div>
          </div>
        )}
      </div>

      {/* Live Tour Overlay (single stop per screen, streamlined) */}
      {liveOverlay && (
        <div className="fixed inset-0 z-[60] bg-white">
          <div className="flex h-full flex-col">
            {/* Overlay header */}
            <div className="flex items-center justify-between border-b border-neutral-200 p-4">
              <div className="text-base font-extrabold text-[#3B82F6]">Step {current + 1} of {max}</div>
              <button
                onClick={() => setLiveOverlay(false)}
                className="rounded-full border px-3 py-1 text-sm inline-flex items-center gap-2"
              >
                <XIcon className="h-4 w-4" /> Exit
              </button>
            </div>

            {/* Content */}
            <div className="flex-1 overflow-auto">
              {(() => {
                const stop = STOPS[current];
                if (!stop) return null;
                const img = stop.photo || "https://placehold.co/800x800?text=No+Photo";
                return (
                  <div className="mx-auto max-w-3xl p-4 space-y-4">
                    {stop.photo && <img src={img} alt="" className="w-full h-80 rounded-2xl object-cover" />}

                    <div>
                      <h2 className="text-2xl font-extrabold">{stop.title}</h2>
                      <p className="mt-1 text-neutral-700">{stop.details || stop.excerpt}</p>
                    </div>

                    <div className="flex flex-wrap gap-2">
                      <button
                        onClick={() => setPlaying((p) => !p)}
                        className="rounded-lg bg-[#EC555C] text-white px-4 py-2 text-sm font-semibold inline-flex items-center gap-2"
                        aria-label={playing ? "Pause audio" : "Play audio"}
                      >
                        {playing ? <Pause className="h-4 w-4" /> : <Play className="h-4 w-4" />}
                        {playing ? "Pause audio" : "Play audio"}
                      </button>
                    </div>

                    <button className="inline-flex items-center gap-2 rounded-md border px-3 py-2 text-[#3B82F6] font-semibold">
                      <Camera className="h-4 w-4" /> Add a photo or note
                    </button>
                  </div>
                );
              })()}
            </div>

            {/* Overlay footer actions — BIG primary Next that auto-completes */}
            <div className="border-t border-neutral-200 p-4">
              <div className="mx-auto max-w-3xl flex items-center justify-between gap-2">
                <button
                  onClick={backInLive}
                  className="rounded-full border px-4 py-2 font-semibold inline-flex items-center gap-2"
                >
                  <ArrowLeft className="h-4 w-4" /> Back
                </button>
                <button
                  onClick={skipInLive}
                  className="rounded-full border px-4 py-2 font-semibold inline-flex items-center gap-2"
                >
                  <SkipForward className="h-4 w-4" /> Skip
                </button>
                {(() => {
                  const remaining = STOPS.filter(s => !checked.includes(s.id));
                  const currentStop = STOPS[current];
                  const isLast = currentStop && remaining.length === 1 && remaining[0].id === currentStop.id;
                  return (
                    <button
                      onClick={nextInLive}
                      className="rounded-full bg-[#3B82F6] text-white px-6 py-3 text-base font-extrabold"
                    >
                      {isLast ? 'Finish' : 'Next stop →'}
                    </button>
                  );
                })()}
              </div>
            </div>
          </div>
        </div>
      )}

      <footer className="pb-16 md:pb-10 pt-6 text-center text-sm text-neutral-600 border-t border-neutral-200">
        © {new Date().getFullYear()} Self‑Guided Tours
      </footer>
    </div>
  );
}


window.SelfGuidedTour = SelfGuidedTour;


// ==== Aliases to predictable globals ====
window.bucketlisted_list_template_mockup_final = window.HoustonListTemplateMock;
window.bucketlisted_list_template_houston_mockup_2 = window.HoustonListTemplateMock;
window.bucketlisted_fort_mc_henry_improved_mockup = window.BucketlistedDesktopOnly;
window.bucketlisted_fort_mc_henry_improved_mockup_1 = window.BucketlistedItemPolished;
window.self_guided_tour_mockup = window.SelfGuidedTour;

const params = new URLSearchParams(location.search);
const view = params.get('view') || 'list-final';

const App = () => {
  if (view === 'list-houston' && window.bucketlisted_list_template_houston_mockup_2) return React.createElement(window.bucketlisted_list_template_houston_mockup_2);
  if (view === 'fort') {
    if (window.bucketlisted_fort_mc_henry_improved_mockup) return React.createElement(window.bucketlisted_fort_mc_henry_improved_mockup);
    if (window.bucketlisted_fort_mc_henry_improved_mockup_1) return React.createElement(window.bucketlisted_fort_mc_henry_improved_mockup_1);
  }
  if (view === 'tour' && window.self_guided_tour_mockup) return React.createElement(window.self_guided_tour_mockup);
  if (window.bucketlisted_list_template_mockup_final) return React.createElement(window.bucketlisted_list_template_mockup_final);
  return React.createElement('div', {className:'text-red-600'}, 'No component loaded.');
};

ReactDOM.createRoot(document.getElementById('app')).render(React.createElement(App));
